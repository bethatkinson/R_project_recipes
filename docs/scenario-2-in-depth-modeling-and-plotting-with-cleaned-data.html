<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Scenario 2: In Depth Modeling and Plotting with Cleaned Data | R Recipes for Common Medical Projects</title>
  <meta name="description" content="2 Scenario 2: In Depth Modeling and Plotting with Cleaned Data | R Recipes for Common Medical Projects" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Scenario 2: In Depth Modeling and Plotting with Cleaned Data | R Recipes for Common Medical Projects" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Scenario 2: In Depth Modeling and Plotting with Cleaned Data | R Recipes for Common Medical Projects" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scenario-1-getting-familiar-with-a-new-project.html"/>
<link rel="next" href="appendix.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">R Recipes for Common Medical Projects</a></li>
<li><a href="./_main.pdf">PDF version of book</a></li>
<li><a href="./data.zip">Download data</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="preface.html"><a href="preface.html#getting-started"><i class="fa fa-check"></i><b>0.1</b> Getting Started</a></li>
<li class="chapter" data-level="0.2" data-path="preface.html"><a href="preface.html#r-markdown"><i class="fa fa-check"></i><b>0.2</b> R markdown</a></li>
<li class="chapter" data-level="0.3" data-path="preface.html"><a href="preface.html#the-data"><i class="fa fa-check"></i><b>0.3</b> The Data</a></li>
<li class="chapter" data-level="0.4" data-path="preface.html"><a href="preface.html#scenarios"><i class="fa fa-check"></i><b>0.4</b> Scenarios</a></li>
<li class="chapter" data-level="0.5" data-path="preface.html"><a href="preface.html#finding-help"><i class="fa fa-check"></i><b>0.5</b> Finding help</a></li>
<li class="chapter" data-level="0.6" data-path="preface.html"><a href="preface.html#disclosure"><i class="fa fa-check"></i><b>0.6</b> Disclosure</a></li>
<li class="chapter" data-level="0.7" data-path="preface.html"><a href="preface.html#contributors"><i class="fa fa-check"></i><b>0.7</b> Contributors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html"><i class="fa fa-check"></i><b>1</b> Scenario 1: Getting Familiar with a New Project</a><ul>
<li class="chapter" data-level="1.1" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#your-mission"><i class="fa fa-check"></i><b>1.1</b> Your Mission</a></li>
<li class="chapter" data-level="1.2" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#implementation"><i class="fa fa-check"></i><b>1.2</b> Implementation</a><ul>
<li class="chapter" data-level="1.2.1" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#import-data"><i class="fa fa-check"></i><b>1.2.1</b> Import Data</a></li>
<li class="chapter" data-level="1.2.2" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#data-exploring"><i class="fa fa-check"></i><b>1.2.2</b> Data Exploring</a></li>
<li class="chapter" data-level="1.2.3" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#data-frame-summary"><i class="fa fa-check"></i><b>1.2.3</b> Data Frame Summary</a></li>
<li class="chapter" data-level="1.2.4" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#plotting"><i class="fa fa-check"></i><b>1.2.4</b> Plotting</a></li>
<li class="chapter" data-level="1.2.5" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#basic-modeling"><i class="fa fa-check"></i><b>1.2.5</b> Basic Modeling</a></li>
<li class="chapter" data-level="1.2.6" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#data-import-revisited"><i class="fa fa-check"></i><b>1.2.6</b> Data Import, revisited</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#resources"><i class="fa fa-check"></i><b>1.3</b> Resources</a><ul>
<li class="chapter" data-level="1.3.1" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#technical-details"><i class="fa fa-check"></i><b>1.3.1</b> Technical details</a></li>
<li class="chapter" data-level="1.3.2" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#example-of-a-real-program"><i class="fa fa-check"></i><b>1.3.2</b> Example of a real program</a></li>
<li class="chapter" data-level="1.3.3" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#packages-used"><i class="fa fa-check"></i><b>1.3.3</b> Packages used</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#optional-ways-to-code"><i class="fa fa-check"></i><b>1.4</b> Optional ways to code</a><ul>
<li class="chapter" data-level="1.4.1" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#alt-import"><i class="fa fa-check"></i><b>1.4.1</b> Data Import</a></li>
<li class="chapter" data-level="1.4.2" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#alt-explore"><i class="fa fa-check"></i><b>1.4.2</b> Data Exploring</a></li>
<li class="chapter" data-level="1.4.3" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#alt-plot"><i class="fa fa-check"></i><b>1.4.3</b> Plotting</a></li>
<li class="chapter" data-level="1.4.4" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#alt-model"><i class="fa fa-check"></i><b>1.4.4</b> Basic Modeling</a></li>
<li class="chapter" data-level="1.4.5" data-path="scenario-1-getting-familiar-with-a-new-project.html"><a href="scenario-1-getting-familiar-with-a-new-project.html#alt-revisited"><i class="fa fa-check"></i><b>1.4.5</b> Data Import, revisited</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><i class="fa fa-check"></i><b>2</b> Scenario 2: In Depth Modeling and Plotting with Cleaned Data</a><ul>
<li class="chapter" data-level="2.1" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#your-mission-1"><i class="fa fa-check"></i><b>2.1</b> Your Mission</a></li>
<li class="chapter" data-level="2.2" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#implementation-1"><i class="fa fa-check"></i><b>2.2</b> Implementation</a><ul>
<li class="chapter" data-level="2.2.1" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#read-and-summarize-data"><i class="fa fa-check"></i><b>2.2.1</b> Read and summarize data</a></li>
<li class="chapter" data-level="2.2.2" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#investigate-missing-data"><i class="fa fa-check"></i><b>2.2.2</b> Investigate missing data</a></li>
<li class="chapter" data-level="2.2.3" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#kaplan-meier"><i class="fa fa-check"></i><b>2.2.3</b> Kaplan-Meier</a></li>
<li class="chapter" data-level="2.2.4" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cumulative-incidence"><i class="fa fa-check"></i><b>2.2.4</b> Cumulative Incidence</a></li>
<li class="chapter" data-level="2.2.5" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#linear-regression-model"><i class="fa fa-check"></i><b>2.2.5</b> Linear regression model</a></li>
<li class="chapter" data-level="2.2.6" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#logistic-regression-models"><i class="fa fa-check"></i><b>2.2.6</b> Logistic regression models</a></li>
<li class="chapter" data-level="2.2.7" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cox-regression-models"><i class="fa fa-check"></i><b>2.2.7</b> Cox regression models</a></li>
<li class="chapter" data-level="2.2.8" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#missingness-revisited-imputation"><i class="fa fa-check"></i><b>2.2.8</b> Missingness revisited: Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#resources-1"><i class="fa fa-check"></i><b>2.3</b> Resources</a><ul>
<li class="chapter" data-level="2.3.1" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#technical-details-1"><i class="fa fa-check"></i><b>2.3.1</b> Technical details</a></li>
<li class="chapter" data-level="2.3.2" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#packages-used-1"><i class="fa fa-check"></i><b>2.3.2</b> Packages used</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#optional-ways-to-code-1"><i class="fa fa-check"></i><b>2.4</b> Optional ways to code</a><ul>
<li class="chapter" data-level="2.4.1" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#alt-loop"><i class="fa fa-check"></i><b>2.4.1</b> Fit multiple models and store results</a></li>
<li class="chapter" data-level="2.4.2" data-path="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#fit-models-by-some-variable"><i class="fa fa-check"></i><b>2.4.2</b> Fit models “by” some variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>3</b> Appendix</a><ul>
<li class="chapter" data-level="3.1" data-path="appendix.html"><a href="appendix.html#appendix-1-tidyverse-package-overviews"><i class="fa fa-check"></i><b>3.1</b> Appendix 1: tidyverse package overviews</a><ul>
<li class="chapter" data-level="3.1.1" data-path="appendix.html"><a href="appendix.html#dplyr"><i class="fa fa-check"></i><b>3.1.1</b> dplyr</a></li>
<li class="chapter" data-level="3.1.2" data-path="appendix.html"><a href="appendix.html#tidyr"><i class="fa fa-check"></i><b>3.1.2</b> tidyr</a></li>
<li class="chapter" data-level="3.1.3" data-path="appendix.html"><a href="appendix.html#lubridate"><i class="fa fa-check"></i><b>3.1.3</b> lubridate</a></li>
<li class="chapter" data-level="3.1.4" data-path="appendix.html"><a href="appendix.html#ggplot2"><i class="fa fa-check"></i><b>3.1.4</b> ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="appendix.html"><a href="appendix.html#appendix-2-r-for-sas-programmers"><i class="fa fa-check"></i><b>3.2</b> Appendix 2: R for SAS programmers</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Recipes for Common Medical Projects</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data" class="section level1">
<h1><span class="header-section-number">2</span> Scenario 2: In Depth Modeling and Plotting with Cleaned Data</h1>
<p>You are working on a project and have cleaned the data using SAS but you would like to create a summary report using R markdown. The study has eleven covariates and three endpoints: discharge status (alive/deceased), time-to-tvr (tricuspid valve replacement), and time-to-death. The investigator is interested in understanding the relationship of the covariates with the different endpoints. Note that some of the covariates have missing values. Also, the investigator would like to see a figure showing the cumulative incidence of TVR curve.</p>
<div id="your-mission-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Your Mission</h2>
<ul>
<li><p>Read in dataset “data2.sas7bdat”. This data was cleaned and labelled in SAS, but you may need to modify some of the variables slightly so that they produce the right summaries. For instance, a number of the variables have the SAS format where 1=‘No’ and 2=‘Yes’. The variable <code>recentmi</code> has four levels: <code>&lt;24 hrs, 1-7 days, &gt;7 days, never</code>. Explore the data and modify the variables as you see fit. Create a list of the variable labels for use in summaries.</p></li>
<li><p>Investigate the missing data patterns. This could be graphically or with tables.</p></li>
<li><p>Create a Kaplan-Meier curve of death for subjects by gender</p>
<ul>
<li>Create a time to death variable (difference between dates). Look at a summary of this new variable.</li>
</ul></li>
<li><p>Create a cumulative incidence curve of TVR where death is treated as a competing risk. Steps include:</p>
<ul>
<li>Create a time-to-tvr variable<br />
</li>
<li>Stratify the curves by gender</li>
</ul></li>
<li><p>Run a linear regression model for bmi with the covariates age and sex. Check the modeling assumptions.</p></li>
<li><p>Run logistic models for <code>dischargestatus</code> and create summary tables for each covariate.</p>
<ul>
<li>Investigate the <code>modelsum()</code> function in the <code>arsenal</code> package and <code>tidy()</code> in the <code>broom</code> package.</li>
</ul></li>
<li><p>Run Cox models for <code>tm2lfu</code> and create summary tables for each covariate.</p>
<ul>
<li>write results to a separate file</li>
<li>check model assumptions</li>
</ul></li>
<li><p>Perform multiple imputation and rerun the logistic regression models</p></li>
</ul>
</div>
<div id="implementation-1" class="section level2">
<h2><span class="header-section-number">2.2</span> Implementation</h2>
<div id="read-and-summarize-data" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Read and summarize data</h3>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Strongly encouraged to set this option!</span></span>
<span id="cb90-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb90-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb90-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Include tidyverse and arsenal to have some basic packages</span></span>
<span id="cb90-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(tidyverse)</span>
<span id="cb90-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(arsenal)</span>
<span id="cb90-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb90-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-8"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Read in data</span></span>
<span id="cb90-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-9"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(haven)</span>
<span id="cb90-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-10"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb90-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-11"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># link to data on GitHub page if not already downloaded</span></span>
<span id="cb90-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-12"></a><span class="er">&gt;</span><span class="st"> </span><span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(<span class="st">&quot;data/dat1.sas7bdat&quot;</span>)) {</span>
<span id="cb90-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-13"></a><span class="op">+</span><span class="st">     </span>urlfile &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/bethatkinson/R_project_recipes/data/dat1.sas7bdat&quot;</span></span>
<span id="cb90-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-14"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;data&quot;</span>)) </span>
<span id="cb90-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-15"></a><span class="op">+</span><span class="st">         </span><span class="kw">dir.create</span>(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb90-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-16"></a><span class="op">+</span><span class="st">     </span><span class="kw">download.file</span>(urlfile, <span class="dt">destfile =</span> <span class="st">&quot;data/dat1.sas7bdat&quot;</span>)</span>
<span id="cb90-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-17"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb90-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-18"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb90-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-19"></a><span class="er">&gt;</span><span class="st"> </span>d1 &lt;-<span class="st"> </span><span class="kw">read_sas</span>(<span class="st">&quot;data/data2.sas7bdat&quot;</span>)</span>
<span id="cb90-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-20"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(d1)</span>
<span id="cb90-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-21"></a> [<span class="dv">1</span>] <span class="st">&quot;AGE&quot;</span>             <span class="st">&quot;RECENTMI&quot;</span>        <span class="st">&quot;cardioshock&quot;</span>     <span class="st">&quot;DIABETES&quot;</span>       </span>
<span id="cb90-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-22"></a> [<span class="dv">5</span>] <span class="st">&quot;hypertension&quot;</span>    <span class="st">&quot;BMI&quot;</span>             <span class="st">&quot;currsmoker&quot;</span>      <span class="st">&quot;msrenaldis&quot;</span>     </span>
<span id="cb90-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-23"></a> [<span class="dv">9</span>] <span class="st">&quot;numdisvessels&quot;</span>   <span class="st">&quot;intrapostmi&quot;</span>     <span class="st">&quot;dischargestatus&quot;</span> <span class="st">&quot;S_DEATH&quot;</span>        </span>
<span id="cb90-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-24"></a>[<span class="dv">13</span>] <span class="st">&quot;S_TVR&quot;</span>           <span class="st">&quot;ID&quot;</span>              <span class="st">&quot;DT_INDEX&quot;</span>        <span class="st">&quot;DT_DEATH&quot;</span>       </span>
<span id="cb90-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb90-25"></a>[<span class="dv">17</span>] <span class="st">&quot;DT_TVR&quot;</span>          <span class="st">&quot;DT_LFU&quot;</span>          <span class="st">&quot;gender&quot;</span>         </span></code></pre></div>
<p>Sometimes variable names have mixed cases, have underscores, or even spaces (especially if reading in data from Excel). The
<code>make.names</code> function removes special characters and spaces from variables names. The option <code>allow_</code> turns underscores to periods. The <code>tolower</code> function changes text so that they are all lowercase.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Change variable names to all lowercase and change underscores to &#39;.&#39;</span></span>
<span id="cb91-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">names</span>(d1) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">make.names</span>(<span class="kw">names</span>(d1), <span class="dt">allow_ =</span> F))</span>
<span id="cb91-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(d1)</span>
<span id="cb91-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-4"></a> [<span class="dv">1</span>] <span class="st">&quot;age&quot;</span>             <span class="st">&quot;recentmi&quot;</span>        <span class="st">&quot;cardioshock&quot;</span>     <span class="st">&quot;diabetes&quot;</span>       </span>
<span id="cb91-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-5"></a> [<span class="dv">5</span>] <span class="st">&quot;hypertension&quot;</span>    <span class="st">&quot;bmi&quot;</span>             <span class="st">&quot;currsmoker&quot;</span>      <span class="st">&quot;msrenaldis&quot;</span>     </span>
<span id="cb91-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-6"></a> [<span class="dv">9</span>] <span class="st">&quot;numdisvessels&quot;</span>   <span class="st">&quot;intrapostmi&quot;</span>     <span class="st">&quot;dischargestatus&quot;</span> <span class="st">&quot;s.death&quot;</span>        </span>
<span id="cb91-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-7"></a>[<span class="dv">13</span>] <span class="st">&quot;s.tvr&quot;</span>           <span class="st">&quot;id&quot;</span>              <span class="st">&quot;dt.index&quot;</span>        <span class="st">&quot;dt.death&quot;</span>       </span>
<span id="cb91-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-8"></a>[<span class="dv">17</span>] <span class="st">&quot;dt.tvr&quot;</span>          <span class="st">&quot;dt.lfu&quot;</span>          <span class="st">&quot;gender&quot;</span>         </span>
<span id="cb91-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-9"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb91-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-10"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># quick exploration of data</span></span>
<span id="cb91-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-11"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(summarytools)</span>
<span id="cb91-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-12"></a>Registered S3 method overwritten by <span class="st">&#39;pryr&#39;</span><span class="op">:</span></span>
<span id="cb91-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-13"></a><span class="st">  </span>method      from</span>
<span id="cb91-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-14"></a>  print.bytes Rcpp</span>
<span id="cb91-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-15"></a>Warning <span class="cf">in</span> <span class="kw">fun</span>(libname, pkgname)<span class="op">:</span><span class="st"> </span>couldn<span class="st">&#39;t connect to display &quot;:0&quot;</span></span>
<span id="cb91-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-16"></a><span class="st">system might not have X11 capabilities; in case of errors when using dfSummary(), set st_options(use.x11 = FALSE)</span></span>
<span id="cb91-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-17"></a></span>
<span id="cb91-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-18"></a><span class="st">Attaching package: &#39;</span>summarytools<span class="st">&#39;</span></span>
<span id="cb91-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-19"></a><span class="st">The following object is masked from &#39;</span>package<span class="op">:</span>tibble<span class="st">&#39;:</span></span>
<span id="cb91-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-20"></a></span>
<span id="cb91-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-21"></a><span class="st">    view</span></span>
<span id="cb91-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-22"></a><span class="st">&gt; dfSummary(d1, graph.col = FALSE)</span></span>
<span id="cb91-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-23"></a><span class="st">Data Frame Summary  </span></span>
<span id="cb91-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-24"></a><span class="st">d1  </span></span>
<span id="cb91-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-25"></a><span class="st">Dimensions: 2000 x 19  </span></span>
<span id="cb91-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-26"></a><span class="st">Duplicates: 0  </span></span>
<span id="cb91-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-27"></a></span>
<span id="cb91-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-28"></a><span class="st">--------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb91-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-29"></a><span class="st">No   Variable          Label                           Stats / Values               Freqs (% of Valid)     Valid      Missing   </span></span>
<span id="cb91-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-30"></a><span class="st">---- ----------------- ------------------------------- ---------------------------- ---------------------- ---------- ----------</span></span>
<span id="cb91-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-31"></a><span class="st">1    age               Age, yrs                        Mean (sd) : 66.6 (12.1)      65 distinct values     2000       0         </span></span>
<span id="cb91-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-32"></a><span class="st">     [numeric]                                         min &lt; med &lt; max:                                    (100%)     (0%)      </span></span>
<span id="cb91-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-33"></a><span class="st">                                                       25 &lt; 67 &lt; 98                                                             </span></span>
<span id="cb91-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-34"></a><span class="st">                                                       IQR (CV) : 18 (0.2)                                                      </span></span>
<span id="cb91-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-35"></a></span>
<span id="cb91-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-36"></a><span class="st">2    recentmi          Recent MI                       Mean (sd) : 2.8 (1.2)        1 : 417 (21.1%)        1972       28        </span></span>
<span id="cb91-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-37"></a><span class="st">     [numeric]                                         min &lt; med &lt; max:             2 : 319 (16.2%)        (98.6%)    (1.4%)    </span></span>
<span id="cb91-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-38"></a><span class="st">                                                       1 &lt; 3 &lt; 4                    3 : 404 (20.5%)                             </span></span>
<span id="cb91-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-39"></a><span class="st">                                                       IQR (CV) : 2 (0.4)           4 : 832 (42.2%)                             </span></span>
<span id="cb91-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-40"></a></span>
<span id="cb91-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-41"></a><span class="st">3    cardioshock       Cardiogenic shock               Min  : 1                     1 : 1920 (96.2%)       1996       4         </span></span>
<span id="cb91-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-42"></a><span class="st">     [numeric]                                         Mean : 1                     2 :   76 ( 3.8%)       (99.8%)    (0.2%)    </span></span>
<span id="cb91-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-43"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-44"></a></span>
<span id="cb91-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-45"></a><span class="st">4    diabetes          Diabetes mellitus               Min  : 1                     1 : 1408 (71.0%)       1984       16        </span></span>
<span id="cb91-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-46"></a><span class="st">     [numeric]                                         Mean : 1.3                   2 :  576 (29.0%)       (99.2%)    (0.8%)    </span></span>
<span id="cb91-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-47"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-48"></a></span>
<span id="cb91-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-49"></a><span class="st">5    hypertension      Hypertension                    Min  : 1                     1 :  359 (18.6%)       1928       72        </span></span>
<span id="cb91-50"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-50"></a><span class="st">     [numeric]                                         Mean : 1.8                   2 : 1569 (81.4%)       (96.4%)    (3.6%)    </span></span>
<span id="cb91-51"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-51"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-52"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-52"></a></span>
<span id="cb91-53"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-53"></a><span class="st">6    bmi               Body Mass Index (kg/sq.m)       Mean (sd) : 30.3 (6.1)       1215 distinct values   1987       13        </span></span>
<span id="cb91-54"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-54"></a><span class="st">     [numeric]                                         min &lt; med &lt; max:                                    (99.35%)   (0.65%)   </span></span>
<span id="cb91-55"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-55"></a><span class="st">                                                       14.3 &lt; 29.4 &lt; 65.4                                                       </span></span>
<span id="cb91-56"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-56"></a><span class="st">                                                       IQR (CV) : 7.5 (0.2)                                                     </span></span>
<span id="cb91-57"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-57"></a></span>
<span id="cb91-58"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-58"></a><span class="st">7    currsmoker        Current Smoker                  Min  : 1                     1 : 1586 (82.1%)       1932       68        </span></span>
<span id="cb91-59"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-59"></a><span class="st">     [numeric]                                         Mean : 1.2                   2 :  346 (17.9%)       (96.6%)    (3.4%)    </span></span>
<span id="cb91-60"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-60"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-61"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-61"></a></span>
<span id="cb91-62"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-62"></a><span class="st">8    msrenaldis        Moderate/Severe renal disease   Min  : 1                     1 : 1889 (95.4%)       1980       20        </span></span>
<span id="cb91-63"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-63"></a><span class="st">     [numeric]                                         Mean : 1                     2 :   91 ( 4.6%)       (99%)      (1%)      </span></span>
<span id="cb91-64"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-64"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-65"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-65"></a></span>
<span id="cb91-66"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-66"></a><span class="st">9    numdisvessels     Number of diseased vessels      Mean (sd) : 1.7 (0.9)        0 :  57 ( 2.9%)        1982       18        </span></span>
<span id="cb91-67"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-67"></a><span class="st">     [numeric]                                         min &lt; med &lt; max:             1 : 898 (45.3%)        (99.1%)    (0.9%)    </span></span>
<span id="cb91-68"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-68"></a><span class="st">                                                       0 &lt; 2 &lt; 3                    2 : 528 (26.6%)                             </span></span>
<span id="cb91-69"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-69"></a><span class="st">                                                       IQR (CV) : 2 (0.5)           3 : 499 (25.2%)                             </span></span>
<span id="cb91-70"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-70"></a></span>
<span id="cb91-71"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-71"></a><span class="st">10   intrapostmi       MI complication (PTCA Reg)      Min  : 1                     1 : 1925 (96.2%)       2000       0         </span></span>
<span id="cb91-72"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-72"></a><span class="st">     [numeric]                                         Mean : 1                     2 :   75 ( 3.8%)       (100%)     (0%)      </span></span>
<span id="cb91-73"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-73"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-74"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-74"></a></span>
<span id="cb91-75"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-75"></a><span class="st">11   dischargestatus   In-hospital death               Min  : 1                     1 : 1976 (98.8%)       2000       0         </span></span>
<span id="cb91-76"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-76"></a><span class="st">     [numeric]                                         Mean : 1                     2 :   24 ( 1.2%)       (100%)     (0%)      </span></span>
<span id="cb91-77"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-77"></a><span class="st">                                                       Max  : 2                                                                 </span></span>
<span id="cb91-78"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-78"></a></span>
<span id="cb91-79"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-79"></a><span class="st">12   s.death           Death Status                    Min  : 0                     0 : 1392 (69.6%)       2000       0         </span></span>
<span id="cb91-80"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-80"></a><span class="st">     [numeric]                                         Mean : 0.3                   1 :  608 (30.4%)       (100%)     (0%)      </span></span>
<span id="cb91-81"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-81"></a><span class="st">                                                       Max  : 1                                                                 </span></span>
<span id="cb91-82"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-82"></a></span>
<span id="cb91-83"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-83"></a><span class="st">13   s.tvr             TVR Status                      Min  : 0                     0 : 1579 (79.0%)       2000       0         </span></span>
<span id="cb91-84"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-84"></a><span class="st">     [numeric]                                         Mean : 0.2                   1 :  421 (21.1%)       (100%)     (0%)      </span></span>
<span id="cb91-85"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-85"></a><span class="st">                                                       Max  : 1                                                                 </span></span>
<span id="cb91-86"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-86"></a></span>
<span id="cb91-87"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-87"></a><span class="st">14   id                Sample ID no.                   Mean (sd) : 1000.5 (577.5)   2000 distinct values   2000       0         </span></span>
<span id="cb91-88"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-88"></a><span class="st">     [numeric]                                         min &lt; med &lt; max:                                    (100%)     (0%)      </span></span>
<span id="cb91-89"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-89"></a><span class="st">                                                       1 &lt; 1000.5 &lt; 2000                                                        </span></span>
<span id="cb91-90"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-90"></a><span class="st">                                                       IQR (CV) : 999.5 (0.6)                                                   </span></span>
<span id="cb91-91"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-91"></a></span>
<span id="cb91-92"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-92"></a><span class="st">15   dt.index          Baseline date                   min : 1990-01-02             1689 distinct values   2000       0         </span></span>
<span id="cb91-93"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-93"></a><span class="st">     [Date]                                            med : 1997-11-06                                    (100%)     (0%)      </span></span>
<span id="cb91-94"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-94"></a><span class="st">                                                       max : 2005-12-28                                                         </span></span>
<span id="cb91-95"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-95"></a><span class="st">                                                       range : 15y 11m 26d                                                      </span></span>
<span id="cb91-96"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-96"></a></span>
<span id="cb91-97"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-97"></a><span class="st">16   dt.death          Death date                      min : 1990-05-01             588 distinct values    608        1392      </span></span>
<span id="cb91-98"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-98"></a><span class="st">     [Date]                                            med : 2001-04-22                                    (30.4%)    (69.6%)   </span></span>
<span id="cb91-99"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-99"></a><span class="st">                                                       max : 2014-11-12                                                         </span></span>
<span id="cb91-100"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-100"></a><span class="st">                                                       range : 24y 6m 11d                                                       </span></span>
<span id="cb91-101"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-101"></a></span>
<span id="cb91-102"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-102"></a><span class="st">17   dt.tvr            TVR date                        min : 1990-02-02             403 distinct values    421        1579      </span></span>
<span id="cb91-103"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-103"></a><span class="st">     [Date]                                            med : 2001-05-15                                    (21.05%)   (78.95%)  </span></span>
<span id="cb91-104"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-104"></a><span class="st">                                                       max : 2015-09-19                                                         </span></span>
<span id="cb91-105"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-105"></a><span class="st">                                                       range : 25y 7m 17d                                                       </span></span>
<span id="cb91-106"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-106"></a></span>
<span id="cb91-107"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-107"></a><span class="st">18   dt.lfu            LFU date                        min : 1990-03-31             1767 distinct values   2000       0         </span></span>
<span id="cb91-108"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-108"></a><span class="st">     [Date]                                            med : 2003-01-12                                    (100%)     (0%)      </span></span>
<span id="cb91-109"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-109"></a><span class="st">                                                       max : 2017-10-10                                                         </span></span>
<span id="cb91-110"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-110"></a><span class="st">                                                       range : 27y 6m 10d                                                       </span></span>
<span id="cb91-111"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-111"></a></span>
<span id="cb91-112"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-112"></a><span class="st">19   gender            Gender                          1. Female                     588 (29.4%)           2000       0         </span></span>
<span id="cb91-113"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-113"></a><span class="st">     [character]                                       2. Male                      1412 (70.6%)           (100%)     (0%)      </span></span>
<span id="cb91-114"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb91-114"></a><span class="st">--------------------------------------------------------------------------------------------------------------------------------</span></span></code></pre></div>
<p>There are several variables that are coded as numbers that we want treated as factors with descriptive values (e.g. No/Yes). The code below loops over all of these No/Yes variables and changes the variables to factors. Tip: this code only works if you specify the variables using <code>d1[[i]]</code>. It will not work if you use <code>d1[,i]</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb92-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Change variables with the values 1/2 to formats with the values No/Yes.  Note</span></span>
<span id="cb92-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb92-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># the use of d1[[i]] to indicate each variable</span></span>
<span id="cb92-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb92-3"></a><span class="er">&gt;</span><span class="st"> </span>ynvars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cardioshock&quot;</span>, <span class="st">&quot;diabetes&quot;</span>, <span class="st">&quot;hypertension&quot;</span>, <span class="st">&quot;currsmoker&quot;</span>, <span class="st">&quot;msrenaldis&quot;</span>, </span>
<span id="cb92-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb92-4"></a><span class="op">+</span><span class="st">     &quot;intrapostmi&quot;</span>)</span>
<span id="cb92-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb92-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span> (i <span class="cf">in</span> ynvars) d1[[i]] &lt;-<span class="st"> </span><span class="kw">factor</span>(d1[[i]], <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>))</span></code></pre></div>
<p>Now create some other factors.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb93-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Change discharge status variable to Alive/Deceased</span></span>
<span id="cb93-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb93-2"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>dischargestatus &lt;-<span class="st"> </span><span class="kw">factor</span>(d1<span class="op">$</span>dischargestatus, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Alive&quot;</span>, </span>
<span id="cb93-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb93-3"></a><span class="op">+</span><span class="st">     &quot;Deceased&quot;</span>))</span></code></pre></div>
<p>In the code below, the level ‘Never’ was moved to the first position so that it can serve as the reference group in models. In models, R by default uses the first level as the reference.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb94-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Chance order of recentmi levels</span></span>
<span id="cb94-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb94-2"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>recentmi &lt;-<span class="st"> </span><span class="kw">factor</span>(d1<span class="op">$</span>recentmi, <span class="dt">levels =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;&gt;7 days&quot;</span>, <span class="st">&quot;1-7 days&quot;</span>, </span>
<span id="cb94-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb94-3"></a><span class="op">+</span><span class="st">     &quot;&lt;24 hrs&quot;</span>), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>This next section of code is a bit tricky, but it demonstrates how to create a mapping between variable labels and variable names, which is useful for <code>tableby</code> and plotting. There are several different functions introduced here including <a href="https://www.rdocumentation.org/packages/base/versions/current/topics/lapply">sapply</a>, <a href="https://www.rdocumentation.org/packages/base/versions/current/topics/unlist">unlist</a>, and <a href="https://www.statmethods.net/management/userfunctions.html">function(x)</a>.</p>
<p>Step 1 essentially takes a dataframe (which is a special type of list), then it uses the <code>sapply</code> function to look at each element in the list (here, each variable) and extracts the label. Finally it takes the results and changes them to be a vector.</p>
<p>Step 5 uses the <a href="https://www.rdocumentation.org/packages/dplyr/versions/current/topics/filter">filter()</a> function which is a part of the <code>dplyr</code> package. It keeps all observations where the <code>labels</code> variable is missing, as determined by <code>is.na()</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># 1. Pull all available labels arsenal has the function labels that extracts all</span></span>
<span id="cb95-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># labels in the df</span></span>
<span id="cb95-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-3"></a><span class="er">&gt;</span><span class="st"> </span>d1_labels &lt;-<span class="st"> </span><span class="kw">labels</span>(d1)</span>
<span id="cb95-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb95-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># 2. Identify which variables don&#39;t have a label Which variables are missing</span></span>
<span id="cb95-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-6"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">names</span>(d1)[<span class="kw">names</span>(d1) <span class="op">%nin%</span><span class="st"> </span><span class="kw">names</span>(<span class="kw">unlist</span>(d1_labels))]</span>
<span id="cb95-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-7"></a>[<span class="dv">1</span>] <span class="st">&quot;recentmi&quot;</span>        <span class="st">&quot;cardioshock&quot;</span>     <span class="st">&quot;diabetes&quot;</span>        <span class="st">&quot;hypertension&quot;</span>   </span>
<span id="cb95-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-8"></a>[<span class="dv">5</span>] <span class="st">&quot;currsmoker&quot;</span>      <span class="st">&quot;msrenaldis&quot;</span>      <span class="st">&quot;intrapostmi&quot;</span>     <span class="st">&quot;dischargestatus&quot;</span></span>
<span id="cb95-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-9"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb95-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-10"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># 3. Add labels to those variables</span></span>
<span id="cb95-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-11"></a><span class="er">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>cardioshock &lt;-<span class="st"> &quot;Cardiogenic shock&quot;</span></span>
<span id="cb95-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-12"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>currsmoker &lt;-<span class="st"> &quot;Current smoker&quot;</span></span>
<span id="cb95-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-13"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>diabetes &lt;-<span class="st"> &quot;Diabetes mellitus&quot;</span></span>
<span id="cb95-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-14"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>dischargestatus &lt;-<span class="st"> &quot;In-hospital death&quot;</span></span>
<span id="cb95-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-15"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>hypertension &lt;-<span class="st"> &quot;Hypertension&quot;</span></span>
<span id="cb95-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-16"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>intrapostmi &lt;-<span class="st"> &quot;MI complication&quot;</span></span>
<span id="cb95-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-17"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>msrenaldis &lt;-<span class="st"> &quot;Moderate/Severe renal disease&quot;</span></span>
<span id="cb95-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-18"></a><span class="op">&gt;</span><span class="st"> </span>d1_labels<span class="op">$</span>recentmi &lt;-<span class="st"> &quot;Recent MI&quot;</span></span>
<span id="cb95-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-19"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb95-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-20"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># create a vector of covariates</span></span>
<span id="cb95-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-21"></a><span class="er">&gt;</span><span class="st"> </span>covar &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;recentmi&quot;</span>, <span class="st">&quot;cardioshock&quot;</span>, <span class="st">&quot;diabetes&quot;</span>, <span class="st">&quot;hypertension&quot;</span>, </span>
<span id="cb95-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb95-22"></a><span class="op">+</span><span class="st">     &quot;bmi&quot;</span>, <span class="st">&quot;currsmoker&quot;</span>, <span class="st">&quot;msrenaldis&quot;</span>, <span class="st">&quot;numdisvessels&quot;</span>, <span class="st">&quot;intrapostmi&quot;</span>)</span></code></pre></div>
</div>
<div id="investigate-missing-data" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Investigate missing data</h3>
<p>From the <code>dfsummary</code> it is apparent that there is some missing data. Before doing any modeling, it would be helpful to better understand the missingness patterns. The <a href="https://www.rdocumentation.org/packages/base/versions/current/topics/apply">apply()</a> function is helpful in that it takes a matrix or dataframe, and does something to each row (<code>MARGIN=1</code>) or column (<code>MARGIN=2</code>). In this case, it uses the function <code>sum()</code> to summarize the number of missings found in the dataframe <code>is.na(d1)</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># How many missing values are there for each variable?</span></span>
<span id="cb96-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-2"></a><span class="er">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">is.na</span>(d1)</span>
<span id="cb96-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(tmp)</span>
<span id="cb96-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-4"></a>       age recentmi cardioshock diabetes hypertension   bmi currsmoker</span>
<span id="cb96-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-5"></a>[<span class="dv">1</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-6"></a>[<span class="dv">2</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-7"></a>[<span class="dv">3</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-8"></a>[<span class="dv">4</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-9"></a>[<span class="dv">5</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-10"></a>[<span class="dv">6</span>,] <span class="ot">FALSE</span>    <span class="ot">FALSE</span>       <span class="ot">FALSE</span>    <span class="ot">FALSE</span>        <span class="ot">FALSE</span> <span class="ot">FALSE</span>      <span class="ot">FALSE</span></span>
<span id="cb96-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-11"></a>     msrenaldis numdisvessels intrapostmi dischargestatus s.death s.tvr    id</span>
<span id="cb96-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-12"></a>[<span class="dv">1</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-13"></a>[<span class="dv">2</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-14"></a>[<span class="dv">3</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-15"></a>[<span class="dv">4</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-16"></a>[<span class="dv">5</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-17"></a>[<span class="dv">6</span>,]      <span class="ot">FALSE</span>         <span class="ot">FALSE</span>       <span class="ot">FALSE</span>           <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb96-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-18"></a>     dt.index dt.death dt.tvr dt.lfu gender</span>
<span id="cb96-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-19"></a>[<span class="dv">1</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-20"></a>[<span class="dv">2</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-21"></a>[<span class="dv">3</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-22"></a>[<span class="dv">4</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-23"></a>[<span class="dv">5</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-24"></a>[<span class="dv">6</span>,]    <span class="ot">FALSE</span>     <span class="ot">TRUE</span>   <span class="ot">TRUE</span>  <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb96-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-25"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sum</span>(tmp[, <span class="dv">2</span>])  <span class="co"># look at 1 variable</span></span>
<span id="cb96-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-26"></a>[<span class="dv">1</span>] <span class="dv">28</span></span>
<span id="cb96-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-27"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">apply</span>(tmp, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> sum)  <span class="co"># use apply to examine all variables</span></span>
<span id="cb96-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-28"></a>            age        recentmi     cardioshock        diabetes    hypertension </span>
<span id="cb96-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-29"></a>              <span class="dv">0</span>              <span class="dv">28</span>               <span class="dv">4</span>              <span class="dv">16</span>              <span class="dv">72</span> </span>
<span id="cb96-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-30"></a>            bmi      currsmoker      msrenaldis   numdisvessels     intrapostmi </span>
<span id="cb96-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-31"></a>             <span class="dv">13</span>              <span class="dv">68</span>              <span class="dv">20</span>              <span class="dv">18</span>               <span class="dv">0</span> </span>
<span id="cb96-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-32"></a>dischargestatus         s.death           s.tvr              id        dt.index </span>
<span id="cb96-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-33"></a>              <span class="dv">0</span>               <span class="dv">0</span>               <span class="dv">0</span>               <span class="dv">0</span>               <span class="dv">0</span> </span>
<span id="cb96-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-34"></a>       dt.death          dt.tvr          dt.lfu          gender </span>
<span id="cb96-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-35"></a>           <span class="dv">1392</span>            <span class="dv">1579</span>               <span class="dv">0</span>               <span class="dv">0</span> </span>
<span id="cb96-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-36"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb96-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-37"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># What is the distribution of missing values by subject?</span></span>
<span id="cb96-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-38"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">sum</span>(tmp[<span class="dv">2</span>, ])  <span class="co"># look at 1 subject</span></span>
<span id="cb96-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-39"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb96-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-40"></a><span class="op">&gt;</span><span class="st"> </span>subj.na &lt;-<span class="st"> </span><span class="kw">apply</span>(tmp, <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> sum)  <span class="co"># use apply to examine all subjects</span></span>
<span id="cb96-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-41"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(subj.na)</span>
<span id="cb96-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-42"></a>subj.na</span>
<span id="cb96-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-43"></a>   <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span> </span>
<span id="cb96-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-44"></a>  <span class="dv">99</span>  <span class="dv">733</span> <span class="dv">1042</span>  <span class="dv">115</span>    <span class="dv">7</span>    <span class="dv">4</span> </span>
<span id="cb96-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-45"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb96-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-46"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Repeat, but only include covariates</span></span>
<span id="cb96-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-47"></a><span class="er">&gt;</span><span class="st"> </span>subj.na &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">is.na</span>(d1[, covar]), <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> sum)</span>
<span id="cb96-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-48"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(subj.na)</span>
<span id="cb96-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-49"></a>subj.na</span>
<span id="cb96-50"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-50"></a>   <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span> </span>
<span id="cb96-51"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb96-51"></a><span class="dv">1785</span>  <span class="dv">198</span>   <span class="dv">13</span>    <span class="dv">1</span>    <span class="dv">3</span> </span></code></pre></div>
<p>There are a number of different packages available to visually explore missing data. The code below illustrates one package called <a href="https://cran.r-project.org/web/packages/naniar/vignettes/getting-started-w-naniar.html"><code>naniar</code></a> written by Nick Tierney.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb97-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(naniar)</span>
<span id="cb97-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb97-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb97-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb97-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">vis_miss</span>(d1[, covar], <span class="dt">cluster =</span> <span class="ot">TRUE</span>)  <span class="co"># cluster observations by missingness</span></span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb98-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb98-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb98-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">gg_miss_var</span>(d1[, covar], <span class="dt">show_pct =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-8-2.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb99-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">gg_miss_var</span>(d1[, <span class="kw">c</span>(<span class="st">&quot;dischargestatus&quot;</span>, covar)], <span class="dt">show_pct =</span> <span class="ot">TRUE</span>, <span class="dt">facet =</span> dischargestatus)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-8-3.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Classification trees using the package <code>rpart</code> can also sometimes be helpful when looking for missingness patterns, especially if you want to understand why a particular variable is missing and whether it is related to any other variable.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(rpart)</span>
<span id="cb100-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(rpart.plot)</span>
<span id="cb100-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb100-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># determine what is associated with missing information about hypertension</span></span>
<span id="cb100-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-5"></a><span class="er">&gt;</span><span class="st"> </span>fit &lt;-<span class="st"> </span><span class="kw">rpart</span>(<span class="kw">is.na</span>(hypertension) <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> d1, <span class="dt">method =</span> <span class="st">&quot;class&quot;</span>, <span class="dt">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb100-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">printcp</span>(fit)</span>
<span id="cb100-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-7"></a></span>
<span id="cb100-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-8"></a>Classification tree<span class="op">:</span></span>
<span id="cb100-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-9"></a><span class="kw">rpart</span>(<span class="dt">formula =</span> <span class="kw">is.na</span>(hypertension) <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> d1, <span class="dt">method =</span> <span class="st">&quot;class&quot;</span>, </span>
<span id="cb100-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-10"></a>    <span class="dt">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb100-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-11"></a></span>
<span id="cb100-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-12"></a>Variables actually used <span class="cf">in</span> tree construction<span class="op">:</span></span>
<span id="cb100-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-13"></a>[<span class="dv">1</span>] age             cardioshock     dischargestatus dt.index       </span>
<span id="cb100-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-14"></a>[<span class="dv">5</span>] dt.lfu          id              recentmi       </span>
<span id="cb100-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-15"></a></span>
<span id="cb100-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-16"></a>Root node error<span class="op">:</span><span class="st"> </span><span class="dv">72</span><span class="op">/</span><span class="dv">2000</span> =<span class="st"> </span><span class="fl">0.036</span></span>
<span id="cb100-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-17"></a></span>
<span id="cb100-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-18"></a>n=<span class="st"> </span><span class="dv">2000</span> </span>
<span id="cb100-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-19"></a></span>
<span id="cb100-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-20"></a>        CP nsplit rel error xerror    xstd</span>
<span id="cb100-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-21"></a><span class="dv">1</span> <span class="fl">0.013889</span>      <span class="dv">0</span>   <span class="fl">1.00000</span> <span class="fl">1.0000</span> <span class="fl">0.11571</span></span>
<span id="cb100-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-22"></a><span class="dv">2</span> <span class="fl">0.010417</span>      <span class="dv">4</span>   <span class="fl">0.93056</span> <span class="fl">1.0694</span> <span class="fl">0.11951</span></span>
<span id="cb100-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-23"></a><span class="dv">3</span> <span class="fl">0.010000</span>      <span class="dv">8</span>   <span class="fl">0.88889</span> <span class="fl">1.0694</span> <span class="fl">0.11951</span></span>
<span id="cb100-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb100-24"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">rpart.plot</span>(fit, <span class="dt">type =</span> <span class="dv">2</span>, <span class="dt">extra =</span> <span class="dv">101</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Running <code>rpart()</code> with the default settings didn’t create any splits because it requires 20 subjects in a node before any splits can be made (<code>minsplit</code> option). Based on the <code>printcp()</code> summary, it appears that 4 splits are necessary to gain much of an improvement in the classification error. The plot suggests that there might be more missingness for those who were alive at discharge and were age 58+.</p>
<p>For now, we are going to proceed, recognizing that missingness is an issue.</p>
</div>
<div id="kaplan-meier" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Kaplan-Meier</h3>
<p>In order to create a KM curve we need time variables and right now we just have dates.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># First attempt - days from Index Date to LFU Date</span></span>
<span id="cb101-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-2"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>tm2death &lt;-<span class="st"> </span>d1<span class="op">$</span>dt.lfu <span class="op">-</span><span class="st"> </span>d1<span class="op">$</span>dt.index</span>
<span id="cb101-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(d1<span class="op">$</span>tm2death)</span>
<span id="cb101-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-4"></a>  Length    Class     Mode </span>
<span id="cb101-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-5"></a>    <span class="dv">2000</span> difftime  numeric </span>
<span id="cb101-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># This is not so helpful, because subtracting dates creates an object of class</span></span>
<span id="cb101-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-7"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># &#39;difftime&#39; Instead, let&#39;s make a numeric object</span></span>
<span id="cb101-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-8"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>tm2death &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(d1<span class="op">$</span>dt.lfu <span class="op">-</span><span class="st"> </span>d1<span class="op">$</span>dt.index)</span>
<span id="cb101-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-9"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(d1<span class="op">$</span>tm2death)</span>
<span id="cb101-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-10"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb101-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-11"></a>    <span class="fl">1.0</span>   <span class="fl">981.2</span>  <span class="fl">1862.0</span>  <span class="fl">1915.8</span>  <span class="fl">2653.2</span>  <span class="fl">4598.0</span> </span>
<span id="cb101-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-12"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb101-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-13"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Create a default KM curve</span></span>
<span id="cb101-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-14"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(survival)</span>
<span id="cb101-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-15"></a><span class="op">&gt;</span><span class="st"> </span>fit &lt;-<span class="st"> </span><span class="kw">survfit</span>(<span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb101-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-16"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(fit, <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">xscale =</span> <span class="fl">365.25</span>, <span class="dt">xlab =</span> <span class="st">&quot;Follow-up, years&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Probability of Survival&quot;</span>)</span>
<span id="cb101-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-17"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>), <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb101-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-18"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb101-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-19"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># If you want the survival estimates at specific time points, use the summary</span></span>
<span id="cb101-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-20"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># function</span></span>
<span id="cb101-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-21"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">summary</span>(fit, <span class="dt">times =</span> <span class="fl">365.25</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb101-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-22"></a>Call<span class="op">:</span><span class="st"> </span><span class="kw">survfit</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb101-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-23"></a></span>
<span id="cb101-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-24"></a>                gender=Female </span>
<span id="cb101-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-25"></a> time n.risk n.event survival std.err lower <span class="dv">95</span><span class="op">% CI upper 95%</span><span class="st"> </span>CI</span>
<span id="cb101-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-26"></a>    <span class="dv">0</span>    <span class="dv">588</span>       <span class="dv">0</span>    <span class="fl">1.000</span>  <span class="fl">0.0000</span>        <span class="fl">1.000</span>        <span class="fl">1.000</span></span>
<span id="cb101-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-27"></a>  <span class="dv">365</span>    <span class="dv">514</span>      <span class="dv">50</span>    <span class="fl">0.913</span>  <span class="fl">0.0117</span>        <span class="fl">0.891</span>        <span class="fl">0.937</span></span>
<span id="cb101-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-28"></a>  <span class="dv">730</span>    <span class="dv">480</span>      <span class="dv">20</span>    <span class="fl">0.877</span>  <span class="fl">0.0137</span>        <span class="fl">0.851</span>        <span class="fl">0.905</span></span>
<span id="cb101-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-29"></a> <span class="dv">1096</span>    <span class="dv">438</span>      <span class="dv">22</span>    <span class="fl">0.836</span>  <span class="fl">0.0157</span>        <span class="fl">0.806</span>        <span class="fl">0.867</span></span>
<span id="cb101-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-30"></a> <span class="dv">1461</span>    <span class="dv">364</span>      <span class="dv">26</span>    <span class="fl">0.783</span>  <span class="fl">0.0178</span>        <span class="fl">0.749</span>        <span class="fl">0.819</span></span>
<span id="cb101-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-31"></a> <span class="dv">1826</span>    <span class="dv">306</span>      <span class="dv">31</span>    <span class="fl">0.713</span>  <span class="fl">0.0202</span>        <span class="fl">0.674</span>        <span class="fl">0.753</span></span>
<span id="cb101-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-32"></a> <span class="dv">2192</span>    <span class="dv">249</span>      <span class="dv">23</span>    <span class="fl">0.654</span>  <span class="fl">0.0220</span>        <span class="fl">0.612</span>        <span class="fl">0.698</span></span>
<span id="cb101-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-33"></a> <span class="dv">2557</span>    <span class="dv">202</span>      <span class="dv">13</span>    <span class="fl">0.617</span>  <span class="fl">0.0230</span>        <span class="fl">0.573</span>        <span class="fl">0.663</span></span>
<span id="cb101-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-34"></a> <span class="dv">2922</span>    <span class="dv">141</span>      <span class="dv">10</span>    <span class="fl">0.578</span>  <span class="fl">0.0246</span>        <span class="fl">0.532</span>        <span class="fl">0.629</span></span>
<span id="cb101-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-35"></a> <span class="dv">3287</span>    <span class="dv">118</span>       <span class="dv">7</span>    <span class="fl">0.549</span>  <span class="fl">0.0257</span>        <span class="fl">0.501</span>        <span class="fl">0.602</span></span>
<span id="cb101-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-36"></a> <span class="dv">3652</span>     <span class="dv">46</span>       <span class="dv">4</span>    <span class="fl">0.514</span>  <span class="fl">0.0299</span>        <span class="fl">0.458</span>        <span class="fl">0.576</span></span>
<span id="cb101-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-37"></a></span>
<span id="cb101-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-38"></a>                gender=Male </span>
<span id="cb101-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-39"></a> time n.risk n.event survival std.err lower <span class="dv">95</span><span class="op">% CI upper 95%</span><span class="st"> </span>CI</span>
<span id="cb101-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-40"></a>    <span class="dv">0</span>   <span class="dv">1412</span>       <span class="dv">0</span>    <span class="fl">1.000</span> <span class="fl">0.00000</span>        <span class="fl">1.000</span>        <span class="fl">1.000</span></span>
<span id="cb101-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-41"></a>  <span class="dv">365</span>   <span class="dv">1225</span>     <span class="dv">111</span>    <span class="fl">0.919</span> <span class="fl">0.00735</span>        <span class="fl">0.905</span>        <span class="fl">0.934</span></span>
<span id="cb101-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-42"></a>  <span class="dv">730</span>   <span class="dv">1132</span>      <span class="dv">52</span>    <span class="fl">0.880</span> <span class="fl">0.00886</span>        <span class="fl">0.862</span>        <span class="fl">0.897</span></span>
<span id="cb101-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-43"></a> <span class="dv">1096</span>   <span class="dv">1014</span>      <span class="dv">54</span>    <span class="fl">0.836</span> <span class="fl">0.01021</span>        <span class="fl">0.816</span>        <span class="fl">0.856</span></span>
<span id="cb101-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-44"></a> <span class="dv">1461</span>    <span class="dv">895</span>      <span class="dv">40</span>    <span class="fl">0.802</span> <span class="fl">0.01115</span>        <span class="fl">0.780</span>        <span class="fl">0.824</span></span>
<span id="cb101-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-45"></a> <span class="dv">1826</span>    <span class="dv">748</span>      <span class="dv">41</span>    <span class="fl">0.762</span> <span class="fl">0.01218</span>        <span class="fl">0.739</span>        <span class="fl">0.786</span></span>
<span id="cb101-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-46"></a> <span class="dv">2192</span>    <span class="dv">610</span>      <span class="dv">38</span>    <span class="fl">0.719</span> <span class="fl">0.01334</span>        <span class="fl">0.694</span>        <span class="fl">0.746</span></span>
<span id="cb101-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-47"></a> <span class="dv">2557</span>    <span class="dv">502</span>      <span class="dv">24</span>    <span class="fl">0.689</span> <span class="fl">0.01416</span>        <span class="fl">0.662</span>        <span class="fl">0.717</span></span>
<span id="cb101-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-48"></a> <span class="dv">2922</span>    <span class="dv">295</span>      <span class="dv">23</span>    <span class="fl">0.643</span> <span class="fl">0.01615</span>        <span class="fl">0.612</span>        <span class="fl">0.675</span></span>
<span id="cb101-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-49"></a> <span class="dv">3287</span>    <span class="dv">247</span>      <span class="dv">10</span>    <span class="fl">0.620</span> <span class="fl">0.01714</span>        <span class="fl">0.587</span>        <span class="fl">0.654</span></span>
<span id="cb101-50"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-50"></a> <span class="dv">3652</span>    <span class="dv">110</span>       <span class="dv">6</span>    <span class="fl">0.592</span> <span class="fl">0.01983</span>        <span class="fl">0.554</span>        <span class="fl">0.632</span></span>
<span id="cb101-51"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-51"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb101-52"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-52"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Fancier plot including table indicating number at risk</span></span>
<span id="cb101-53"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-53"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(survminer)</span>
<span id="cb101-54"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-54"></a>Loading required package<span class="op">:</span><span class="st"> </span>ggpubr</span>
<span id="cb101-55"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-55"></a>Loading required package<span class="op">:</span><span class="st"> </span>magrittr</span>
<span id="cb101-56"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-56"></a>Warning<span class="op">:</span><span class="st"> </span>package <span class="st">&#39;magrittr&#39;</span> was built under R version <span class="dv">4</span>.<span class="fl">0.2</span></span>
<span id="cb101-57"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-57"></a></span>
<span id="cb101-58"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-58"></a>Attaching package<span class="op">:</span><span class="st"> &#39;magrittr&#39;</span></span>
<span id="cb101-59"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-59"></a>The following object is masked from <span class="st">&#39;package:purrr&#39;</span><span class="op">:</span></span>
<span id="cb101-60"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-60"></a></span>
<span id="cb101-61"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-61"></a><span class="st">    </span>set_names</span>
<span id="cb101-62"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-62"></a>The following object is masked from <span class="st">&#39;package:tidyr&#39;</span><span class="op">:</span></span>
<span id="cb101-63"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-63"></a></span>
<span id="cb101-64"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-64"></a><span class="st">    </span>extract</span>
<span id="cb101-65"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-65"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb101-66"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-66"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggsurvplot</span>(fit, <span class="dt">risk.table =</span> <span class="ot">TRUE</span>, <span class="dt">pval =</span> <span class="ot">TRUE</span>, <span class="dt">censor =</span> <span class="ot">FALSE</span>, <span class="dt">xscale =</span> <span class="fl">365.25</span>, </span>
<span id="cb101-67"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-67"></a><span class="op">+</span><span class="st">     </span><span class="dt">break.time.by =</span> <span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="fl">365.25</span>)</span>
<span id="cb101-68"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-68"></a>Warning<span class="op">:</span><span class="st"> </span>Vectorized input to <span class="st">`</span><span class="dt">element_text()</span><span class="st">`</span> is not officially supported.</span>
<span id="cb101-69"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb101-69"></a>Results may be unexpected or may change <span class="cf">in</span> future versions of ggplot2.</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/km-1.png" width="80%" style="display: block; margin: auto;" /><img src="02-scenario2_files/figure-html/km-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="cumulative-incidence" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Cumulative Incidence</h3>
<p>Now look at the time to TVR where death is treated as a competing risk.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Create time to TVR (if event) or LFU The pmin function estimates the smallest</span></span>
<span id="cb102-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># value, by row, not including missings</span></span>
<span id="cb102-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-3"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>tm2tvr &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">pmin</span>(d1<span class="op">$</span>dt.tvr, d1<span class="op">$</span>dt.lfu, <span class="dt">na.rm =</span> T) <span class="op">-</span><span class="st"> </span>d1<span class="op">$</span>dt.index)</span>
<span id="cb102-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb102-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Create event variable with 3 levels: censor, TVR, death</span></span>
<span id="cb102-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-6"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">with</span>(d1, <span class="kw">table</span>(<span class="dt">death =</span> s.death, <span class="dt">tvr =</span> s.tvr))</span>
<span id="cb102-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-7"></a>     tvr</span>
<span id="cb102-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-8"></a>death    <span class="dv">0</span>    <span class="dv">1</span></span>
<span id="cb102-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-9"></a>    <span class="dv">0</span> <span class="dv">1078</span>  <span class="dv">314</span></span>
<span id="cb102-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-10"></a>    <span class="dv">1</span>  <span class="dv">501</span>  <span class="dv">107</span></span>
<span id="cb102-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-11"></a><span class="op">&gt;</span><span class="st"> </span>d1<span class="op">$</span>event &lt;-<span class="st"> </span><span class="kw">with</span>(d1, <span class="kw">ifelse</span>(s.tvr <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>s.death, <span class="dv">1</span>))</span>
<span id="cb102-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-12"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(d1<span class="op">$</span>event)</span>
<span id="cb102-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-13"></a></span>
<span id="cb102-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-14"></a>   <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span> </span>
<span id="cb102-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-15"></a><span class="dv">1078</span>  <span class="dv">421</span>  <span class="dv">501</span> </span>
<span id="cb102-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-16"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># In order to do competing risks, the status variable must be a factor</span></span>
<span id="cb102-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-17"></a><span class="er">&gt;</span><span class="st"> </span>d1<span class="op">$</span>event &lt;-<span class="st"> </span><span class="kw">factor</span>(d1<span class="op">$</span>event, <span class="dt">levels =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;censor&quot;</span>, <span class="st">&quot;tvr&quot;</span>, <span class="st">&quot;death&quot;</span>))</span>
<span id="cb102-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-18"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb102-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-19"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># confirm coding makes sense</span></span>
<span id="cb102-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-20"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(arsenal)</span>
<span id="cb102-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-21"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">freqlist</span>(<span class="kw">table</span>(<span class="dt">new_event =</span> d1<span class="op">$</span>event, <span class="dt">tvr =</span> d1<span class="op">$</span>s.tvr, <span class="dt">death =</span> d1<span class="op">$</span>s.death)))</span>
<span id="cb102-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-22"></a></span>
<span id="cb102-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-23"></a></span>
<span id="cb102-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-24"></a><span class="op">|</span>new_event <span class="op">|</span>tvr <span class="op">|</span>death <span class="op">|</span><span class="st"> </span>Freq<span class="op">|</span><span class="st"> </span>Cumulative Freq<span class="op">|</span><span class="st"> </span>Percent<span class="op">|</span><span class="st"> </span>Cumulative Percent<span class="op">|</span></span>
<span id="cb102-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-25"></a><span class="er">|:</span><span class="op">---------</span><span class="er">|:</span><span class="op">---</span><span class="er">|:</span><span class="op">-----</span><span class="er">|</span><span class="op">----</span><span class="er">:|</span><span class="op">---------------</span><span class="er">:|</span><span class="op">-------</span><span class="er">:|</span><span class="op">------------------</span><span class="er">:|</span></span>
<span id="cb102-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-26"></a><span class="er">|</span>censor    <span class="op">|</span><span class="dv">0</span>   <span class="op">|</span><span class="dv">0</span>     <span class="op">|</span><span class="st"> </span><span class="dv">1078</span><span class="op">|</span><span class="st">            </span><span class="dv">1078</span><span class="op">|</span><span class="st">   </span><span class="fl">53.90</span><span class="op">|</span><span class="st">              </span><span class="fl">53.90</span><span class="op">|</span></span>
<span id="cb102-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-27"></a><span class="er">|</span>tvr       <span class="op">|</span><span class="dv">1</span>   <span class="op">|</span><span class="dv">0</span>     <span class="op">|</span><span class="st">  </span><span class="dv">314</span><span class="op">|</span><span class="st">            </span><span class="dv">1392</span><span class="op">|</span><span class="st">   </span><span class="fl">15.70</span><span class="op">|</span><span class="st">              </span><span class="fl">69.60</span><span class="op">|</span></span>
<span id="cb102-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-28"></a><span class="er">|</span><span class="st">          </span><span class="er">|</span><span class="st">    </span><span class="er">|</span><span class="dv">1</span>     <span class="op">|</span><span class="st">  </span><span class="dv">107</span><span class="op">|</span><span class="st">            </span><span class="dv">1499</span><span class="op">|</span><span class="st">    </span><span class="fl">5.35</span><span class="op">|</span><span class="st">              </span><span class="fl">74.95</span><span class="op">|</span></span>
<span id="cb102-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-29"></a><span class="er">|</span>death     <span class="op">|</span><span class="dv">0</span>   <span class="op">|</span><span class="dv">1</span>     <span class="op">|</span><span class="st">  </span><span class="dv">501</span><span class="op">|</span><span class="st">            </span><span class="dv">2000</span><span class="op">|</span><span class="st">   </span><span class="fl">25.05</span><span class="op">|</span><span class="st">             </span><span class="fl">100.00</span><span class="op">|</span></span>
<span id="cb102-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-30"></a><span class="er">&gt;</span><span class="st"> </span></span>
<span id="cb102-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-31"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Fit the cumulative incidence curves</span></span>
<span id="cb102-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-32"></a><span class="er">&gt;</span><span class="st"> </span>fit &lt;-<span class="st"> </span><span class="kw">survfit</span>(<span class="kw">Surv</span>(tm2tvr, event) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb102-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-33"></a><span class="op">&gt;</span><span class="st"> </span>fit</span>
<span id="cb102-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-34"></a>Call<span class="op">:</span><span class="st"> </span><span class="kw">survfit</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(tm2tvr, event) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb102-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-35"></a></span>
<span id="cb102-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-36"></a>                        n nevent    rmean<span class="op">*</span></span>
<span id="cb102-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-37"></a>gender=Female, (s0)   <span class="dv">588</span>      <span class="dv">0</span> <span class="fl">2658.4914</span></span>
<span id="cb102-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-38"></a>gender=Male, (s0)    <span class="dv">1412</span>      <span class="dv">0</span> <span class="fl">2755.6290</span></span>
<span id="cb102-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-39"></a>gender=Female, tvr    <span class="dv">588</span>    <span class="dv">102</span>  <span class="fl">803.9427</span></span>
<span id="cb102-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-40"></a>gender=Male, tvr     <span class="dv">1412</span>    <span class="dv">319</span>  <span class="fl">945.0840</span></span>
<span id="cb102-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-41"></a>gender=Female, death  <span class="dv">588</span>    <span class="dv">177</span> <span class="fl">1135.5658</span></span>
<span id="cb102-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-42"></a>gender=Male, death   <span class="dv">1412</span>    <span class="dv">324</span>  <span class="fl">897.2870</span></span>
<span id="cb102-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-43"></a>   <span class="op">*</span>mean time <span class="cf">in</span> state, <span class="kw">restricted</span> (max <span class="dt">time =</span> <span class="dv">4598</span> )</span>
<span id="cb102-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-44"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(fit, <span class="dt">col =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">xscale =</span> <span class="fl">365.25</span>, <span class="dt">xlab =</span> <span class="st">&quot;Follow-up, years&quot;</span>, </span>
<span id="cb102-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-45"></a><span class="op">+</span><span class="st">     </span><span class="dt">ylab =</span> <span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb102-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-46"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;female: tvr&quot;</span>, <span class="st">&quot;male: tvr&quot;</span>, <span class="st">&quot;female: death&quot;</span>, <span class="st">&quot;male: death&quot;</span>), </span>
<span id="cb102-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb102-47"></a><span class="op">+</span><span class="st">     </span><span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/comprisk-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb103-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co">## look at only certain portions of the survfit object rows=strata, columns=states</span></span>
<span id="cb103-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">dim</span>(fit)</span>
<span id="cb103-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-4"></a>strata states </span>
<span id="cb103-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-5"></a>     <span class="dv">2</span>      <span class="dv">3</span> </span>
<span id="cb103-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-6"></a><span class="op">&gt;</span><span class="st"> </span>fit<span class="op">$</span>strata</span>
<span id="cb103-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-7"></a>gender=Female   gender=Male </span>
<span id="cb103-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-8"></a>          <span class="dv">499</span>          <span class="dv">1020</span> </span>
<span id="cb103-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-9"></a><span class="op">&gt;</span><span class="st"> </span>fit<span class="op">$</span>states</span>
<span id="cb103-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-10"></a>[<span class="dv">1</span>] <span class="st">&quot;(s0)&quot;</span>  <span class="st">&quot;tvr&quot;</span>   <span class="st">&quot;death&quot;</span></span>
<span id="cb103-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-11"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb103-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-12"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># re-plot, just including tvr</span></span>
<span id="cb103-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-13"></a><span class="er">&gt;</span><span class="st"> </span>fit2 &lt;-<span class="st"> </span>fit[, <span class="dv">2</span>]</span>
<span id="cb103-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-14"></a><span class="op">&gt;</span><span class="st"> </span>fit2  <span class="co"># confirm that this just picks up the tvr events</span></span>
<span id="cb103-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-15"></a>Call<span class="op">:</span><span class="st"> </span><span class="kw">survfit</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(tm2tvr, event) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb103-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-16"></a></span>
<span id="cb103-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-17"></a>                      n nevent   rmean<span class="op">*</span></span>
<span id="cb103-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-18"></a>gender=Female, tvr  <span class="dv">588</span>    <span class="dv">102</span> <span class="fl">803.9427</span></span>
<span id="cb103-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-19"></a>gender=Male, tvr   <span class="dv">1412</span>    <span class="dv">319</span> <span class="fl">945.0840</span></span>
<span id="cb103-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-20"></a>   <span class="op">*</span>mean time <span class="cf">in</span> state, <span class="kw">restricted</span> (max <span class="dt">time =</span> <span class="dv">4598</span> )</span>
<span id="cb103-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-21"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb103-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-22"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">plot</span>(fit2, <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">xscale =</span> <span class="fl">365.25</span>, <span class="dt">xlab =</span> <span class="st">&quot;Follow-up, years&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Cumulative Incidence of TVR&quot;</span>, </span>
<span id="cb103-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-23"></a><span class="op">+</span><span class="st">     </span><span class="dt">xmax =</span> <span class="dv">11</span> <span class="op">*</span><span class="st"> </span><span class="fl">365.25</span>)</span>
<span id="cb103-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb103-24"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>), <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/comprisk-2.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb104-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co">## Fit model</span></span>
<span id="cb104-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-3"></a><span class="er">&gt;</span><span class="st"> </span>cfit &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2tvr, event) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1, <span class="dt">id =</span> id)</span>
<span id="cb104-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb104-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="co">## If you are just interested in tvr, then you get the same results using</span></span>
<span id="cb104-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb104-6"></a><span class="er">&gt;</span><span class="st"> </span>cfit2 &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2tvr, event <span class="op">==</span><span class="st"> &quot;tvr&quot;</span>) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1, <span class="dt">id =</span> id)</span></code></pre></div>
</div>
<div id="linear-regression-model" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Linear regression model</h3>
<p>Assess how BMI differs by age and gender, then check the model assumptions. Don’t assume that the functional form for age is linear. The <code>splines</code> package includes the natural splines function <code>ns</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(splines)  <span class="co"># needed to load the ns() function</span></span>
<span id="cb105-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-2"></a><span class="op">&gt;</span><span class="st"> </span>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(bmi <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb105-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(fit)</span>
<span id="cb105-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-4"></a></span>
<span id="cb105-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-5"></a>Call<span class="op">:</span></span>
<span id="cb105-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-6"></a><span class="kw">lm</span>(<span class="dt">formula =</span> bmi <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb105-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-7"></a></span>
<span id="cb105-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-8"></a>Residuals<span class="op">:</span></span>
<span id="cb105-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-9"></a><span class="st">    </span>Min      1Q  Median      3Q     Max </span>
<span id="cb105-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-10"></a><span class="fl">-17.284</span>  <span class="fl">-4.034</span>  <span class="fl">-0.870</span>   <span class="fl">3.178</span>  <span class="fl">33.668</span> </span>
<span id="cb105-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-11"></a></span>
<span id="cb105-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-12"></a>Coefficients<span class="op">:</span></span>
<span id="cb105-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-13"></a><span class="st">                 </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)    </span>
<span id="cb105-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-14"></a>(Intercept)       <span class="fl">30.7571</span>     <span class="fl">1.5463</span>  <span class="fl">19.891</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb105-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-15"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">1</span>  <span class="fl">-1.3705</span>     <span class="fl">0.8080</span>  <span class="fl">-1.696</span>   <span class="fl">0.0900</span> .  </span>
<span id="cb105-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-16"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">2</span>  <span class="fl">-1.9786</span>     <span class="fl">3.4576</span>  <span class="fl">-0.572</span>   <span class="fl">0.5672</span>    </span>
<span id="cb105-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-17"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">3</span>  <span class="fl">-7.3226</span>     <span class="fl">1.2885</span>  <span class="fl">-5.683</span> <span class="fl">1.52e-08</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb105-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-18"></a>genderMale        <span class="fl">-0.6195</span>     <span class="fl">0.2977</span>  <span class="fl">-2.081</span>   <span class="fl">0.0376</span> <span class="op">*</span><span class="st">  </span></span>
<span id="cb105-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-19"></a><span class="op">---</span></span>
<span id="cb105-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-20"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb105-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-21"></a></span>
<span id="cb105-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-22"></a>Residual standard error<span class="op">:</span><span class="st"> </span><span class="fl">5.945</span> on <span class="dv">1982</span> degrees of freedom</span>
<span id="cb105-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-23"></a>  (<span class="dv">13</span> observations deleted due to missingness)</span>
<span id="cb105-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-24"></a>Multiple R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">0.05133</span>,   Adjusted R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">0.04942</span> </span>
<span id="cb105-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-25"></a>F<span class="op">-</span>statistic<span class="op">:</span><span class="st"> </span><span class="fl">26.81</span> on <span class="dv">4</span> and <span class="dv">1982</span> DF,  p<span class="op">-</span>value<span class="op">:</span><span class="st"> </span><span class="er">&lt;</span><span class="st"> </span><span class="fl">2.2e-16</span></span>
<span id="cb105-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-26"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb105-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-27"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># plot the curvature</span></span>
<span id="cb105-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb105-28"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">termplot</span>(fit, <span class="dt">term =</span> <span class="dv">1</span>, <span class="dt">se =</span> T, <span class="dt">rug =</span> T)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb106-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb106-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb106-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># visually check model assumptions</span></span>
<span id="cb106-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb106-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">plot</span>(fit)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-10-2.png" width="80%" style="display: block; margin: auto;" /><img src="02-scenario2_files/figure-html/unnamed-chunk-10-3.png" width="80%" style="display: block; margin: auto;" /><img src="02-scenario2_files/figure-html/unnamed-chunk-10-4.png" width="80%" style="display: block; margin: auto;" /><img src="02-scenario2_files/figure-html/unnamed-chunk-10-5.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb107-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb107-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb107-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># summarize residuals</span></span>
<span id="cb107-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb107-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">resid</span>(fit))</span>
<span id="cb107-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb107-4"></a>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span>
<span id="cb107-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb107-5"></a><span class="fl">-17.2845</span>  <span class="fl">-4.0336</span>  <span class="fl">-0.8697</span>   <span class="fl">0.0000</span>   <span class="fl">3.1778</span>  <span class="fl">33.6684</span> </span></code></pre></div>
<p>The following code plots the relationship between age and BMI separately for males and females with a smoother through the points, providing further insight into the data.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb108-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(d1, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> bmi)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">span =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb108-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb108-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">facet_wrap</span>(<span class="op">~</span>gender)</span>
<span id="cb108-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb108-3"></a><span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;gam&#39;</span> and formula <span class="st">&#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span></span>
<span id="cb108-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb108-4"></a>Warning<span class="op">:</span><span class="st"> </span>Removed <span class="dv">13</span> rows containing non<span class="op">-</span>finite <span class="kw">values</span> (stat_smooth).</span>
<span id="cb108-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb108-5"></a>Warning<span class="op">:</span><span class="st"> </span>Removed <span class="dv">13</span> rows containing missing <span class="kw">values</span> (geom_point).</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="logistic-regression-models" class="section level3">
<h3><span class="header-section-number">2.2.6</span> Logistic regression models</h3>
<p>Assess which risk factors predict the discharge status: <code>dischargestatus</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-1"></a><span class="op">&gt;</span><span class="st"> </span>d1<span class="op">$</span>dischargestatus01 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(d1<span class="op">$</span>dischargestatus) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb109-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">with</span>(d1, <span class="kw">table</span>(dischargestatus01, dischargestatus))</span>
<span id="cb109-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-3"></a>                 dischargestatus</span>
<span id="cb109-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-4"></a>dischargestatus01 Alive Deceased</span>
<span id="cb109-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-5"></a>                <span class="dv">0</span>  <span class="dv">1976</span>        <span class="dv">0</span></span>
<span id="cb109-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-6"></a>                <span class="dv">1</span>     <span class="dv">0</span>       <span class="dv">24</span></span>
<span id="cb109-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb109-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-8"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Look at a simple model: the association between gender and in-hospital death</span></span>
<span id="cb109-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-9"></a><span class="er">&gt;</span><span class="st"> </span>fit3 &lt;-<span class="st"> </span><span class="kw">glm</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb109-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-10"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(fit3)</span>
<span id="cb109-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-11"></a></span>
<span id="cb109-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-12"></a>Call<span class="op">:</span></span>
<span id="cb109-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-13"></a><span class="kw">glm</span>(<span class="dt">formula =</span> dischargestatus01 <span class="op">~</span><span class="st"> </span>gender, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb109-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-14"></a>    <span class="dt">data =</span> d1)</span>
<span id="cb109-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-15"></a></span>
<span id="cb109-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-16"></a>Deviance Residuals<span class="op">:</span><span class="st"> </span></span>
<span id="cb109-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-17"></a><span class="st">    </span>Min       1Q   Median       3Q      Max  </span>
<span id="cb109-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-18"></a><span class="fl">-0.1689</span>  <span class="fl">-0.1689</span>  <span class="fl">-0.1689</span>  <span class="fl">-0.1168</span>   <span class="fl">3.1593</span>  </span>
<span id="cb109-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-19"></a></span>
<span id="cb109-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-20"></a>Coefficients<span class="op">:</span></span>
<span id="cb109-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-21"></a><span class="st">            </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)    </span>
<span id="cb109-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-22"></a>(Intercept)  <span class="fl">-4.9836</span>     <span class="fl">0.5016</span>  <span class="fl">-9.935</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb109-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-23"></a>genderMale    <span class="fl">0.7408</span>     <span class="fl">0.5499</span>   <span class="fl">1.347</span>    <span class="fl">0.178</span>    </span>
<span id="cb109-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-24"></a><span class="op">---</span></span>
<span id="cb109-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-25"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb109-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-26"></a></span>
<span id="cb109-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-27"></a>(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</span>
<span id="cb109-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-28"></a></span>
<span id="cb109-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-29"></a>    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">260.01</span>  on <span class="dv">1999</span>  degrees of freedom</span>
<span id="cb109-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-30"></a>Residual deviance<span class="op">:</span><span class="st"> </span><span class="fl">257.89</span>  on <span class="dv">1998</span>  degrees of freedom</span>
<span id="cb109-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-31"></a>AIC<span class="op">:</span><span class="st"> </span><span class="fl">261.89</span></span>
<span id="cb109-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-32"></a></span>
<span id="cb109-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb109-33"></a>Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">7</span></span></code></pre></div>
<p>The <code>broom</code> package allows users to extract information from a model and save it as a <code>data.frame</code>. The two main functions in <code>broom</code> are <code>tidy()</code>, which returns a tidy version of the model coefficients, and <code>glance()</code> which returns a one-row glance at the model’s statistics. There is also the function <code>augment()</code> which augments the original data with information such as the fitted values and residuals.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Look at a tidy model summary (data frame)</span></span>
<span id="cb110-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</span>
<span id="cb110-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># &#39;exponentiate=TRUE&#39; exponentiates the estimates, including the intercept</span></span>
<span id="cb110-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-4"></a><span class="er">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">tidy</span>(fit3, <span class="dt">exponentiate =</span> <span class="ot">TRUE</span>, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span>
<span id="cb110-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(tmp, <span class="dt">digits =</span> <span class="dv">3</span>)</span>
<span id="cb110-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-6"></a><span class="co"># A tibble: 2 x 7</span></span>
<span id="cb110-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-7"></a>  term        estimate std.error statistic  p.value conf.low conf.high</span>
<span id="cb110-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-8"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb110-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-9"></a><span class="dv">1</span> (Intercept)  <span class="fl">0.00685</span>     <span class="fl">0.502</span>     <span class="fl">-9.93</span> <span class="fl">2.94e-23</span>  <span class="fl">0.00212</span>    <span class="fl">0.0160</span></span>
<span id="cb110-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-10"></a><span class="dv">2</span> genderMale   <span class="fl">2.10</span>        <span class="fl">0.550</span>      <span class="fl">1.35</span> <span class="fl">1.78</span>e<span class="op">-</span><span class="st"> </span><span class="dv">1</span>  <span class="fl">0.790</span>      <span class="fl">7.24</span>  </span>
<span id="cb110-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-11"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Remove the intercept line</span></span>
<span id="cb110-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-12"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">print</span>(tmp[<span class="op">-</span><span class="dv">1</span>, ], <span class="dt">digits =</span> <span class="dv">3</span>)</span>
<span id="cb110-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-13"></a><span class="co"># A tibble: 1 x 7</span></span>
<span id="cb110-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-14"></a>  term       estimate std.error statistic p.value conf.low conf.high</span>
<span id="cb110-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-15"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb110-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-16"></a><span class="dv">1</span> genderMale     <span class="fl">2.10</span>     <span class="fl">0.550</span>      <span class="fl">1.35</span>   <span class="fl">0.178</span>    <span class="fl">0.790</span>      <span class="fl">7.24</span></span>
<span id="cb110-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-17"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">glance</span>(fit3)</span>
<span id="cb110-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-18"></a><span class="co"># A tibble: 1 x 7</span></span>
<span id="cb110-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-19"></a>  null.deviance df.null logLik   AIC   BIC deviance df.residual</span>
<span id="cb110-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-20"></a>          <span class="op">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>int<span class="op">&gt;</span></span>
<span id="cb110-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb110-21"></a><span class="dv">1</span>          <span class="fl">260.</span>    <span class="dv">1999</span>  <span class="fl">-129.</span>  <span class="fl">262.</span>  <span class="fl">273.</span>     <span class="fl">258.</span>        <span class="dv">1998</span></span></code></pre></div>
<p>This is fine for a small number of models, but if you want to summarize results for multiple models, perhaps adjusting for a certain set of covariates, then it is time to use a different tool. The <code>modelsum()</code> in <code>arsenal</code> creates such summaries. For logistic regression models (<code>family='binomial'</code>), the results are automatically shown with odd’s ratios and confidence intervals, plus the concordance (AUC) value and the number of missing values for that variable.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb111-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Use formulize in arsenal to create a formula to pass to modelsum</span></span>
<span id="cb111-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb111-2"></a><span class="er">&gt;</span><span class="st"> </span>myform &lt;-<span class="st"> </span><span class="kw">formulize</span>(<span class="dt">y =</span> <span class="st">&quot;dischargestatus01&quot;</span>, <span class="dt">x =</span> covar)</span>
<span id="cb111-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb111-3"></a><span class="op">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">modelsum</span>(myform, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="dt">data =</span> d1)</span>
<span id="cb111-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb111-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(tmp, <span class="dt">show.intercept =</span> F, <span class="dt">title =</span> <span class="st">&quot;Hospital Discharge: Univariate analysis&quot;</span>)</span></code></pre></div>
<table>
<caption>Hospital Discharge: Univariate analysis</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">OR</th>
<th align="left">CI.lower.OR</th>
<th align="left">CI.upper.OR</th>
<th align="left">p.value</th>
<th align="left">concordance</th>
<th align="left">Nmiss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Age, yrs</strong></td>
<td align="left">1.020</td>
<td align="left">0.986</td>
<td align="left">1.057</td>
<td align="left">0.259</td>
<td align="left">0.555</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left"><strong>Gender Male</strong></td>
<td align="left">2.098</td>
<td align="left">0.790</td>
<td align="left">7.236</td>
<td align="left">0.178</td>
<td align="left">0.564</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left"><strong>recentmi .L</strong></td>
<td align="left">5.914</td>
<td align="left">2.554</td>
<td align="left">16.883</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.742</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left"><strong>recentmi .Q</strong></td>
<td align="left">1.260</td>
<td align="left">0.452</td>
<td align="left">3.903</td>
<td align="left">0.662</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><strong>recentmi .C</strong></td>
<td align="left">0.760</td>
<td align="left">0.201</td>
<td align="left">2.227</td>
<td align="left">0.637</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><strong>cardioshock Yes</strong></td>
<td align="left">91.915</td>
<td align="left">36.761</td>
<td align="left">262.524</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.855</td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="left"><strong>diabetes Yes</strong></td>
<td align="left">0.978</td>
<td align="left">0.347</td>
<td align="left">2.418</td>
<td align="left">0.963</td>
<td align="left">0.502</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left"><strong>hypertension Yes</strong></td>
<td align="left">0.415</td>
<td align="left">0.157</td>
<td align="left">1.213</td>
<td align="left">0.086</td>
<td align="left">0.584</td>
<td align="left">72</td>
</tr>
<tr class="odd">
<td align="left"><strong>Body Mass Index (kg/sq.m)</strong></td>
<td align="left">0.934</td>
<td align="left">0.860</td>
<td align="left">1.007</td>
<td align="left">0.094</td>
<td align="left">0.588</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left"><strong>currsmoker Yes</strong></td>
<td align="left">1.982</td>
<td align="left">0.697</td>
<td align="left">4.978</td>
<td align="left">0.164</td>
<td align="left">0.561</td>
<td align="left">68</td>
</tr>
<tr class="odd">
<td align="left"><strong>msrenaldis Yes</strong></td>
<td align="left">1.038</td>
<td align="left">0.058</td>
<td align="left">5.067</td>
<td align="left">0.971</td>
<td align="left">0.501</td>
<td align="left">20</td>
</tr>
<tr class="even">
<td align="left"><strong>Number of diseased vessels</strong></td>
<td align="left">1.407</td>
<td align="left">0.880</td>
<td align="left">2.270</td>
<td align="left">0.154</td>
<td align="left">0.577</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="left"><strong>intrapostmi Yes</strong></td>
<td align="left">2.370</td>
<td align="left">0.375</td>
<td align="left">8.251</td>
<td align="left">0.249</td>
<td align="left">0.523</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb112-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Note - because recentmi is an ordered factor, R tries to model it with</span></span>
<span id="cb112-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Linear/Quadradic/Cubic. Try creating covar2 - see the difference</span></span>
<span id="cb112-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-4"></a><span class="er">&gt;</span><span class="st"> </span>covar2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;as.numeric(recentmi)&quot;</span>, <span class="st">&quot;cardioshock&quot;</span>, <span class="st">&quot;diabetes&quot;</span>, <span class="st">&quot;hypertension&quot;</span>, </span>
<span id="cb112-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-5"></a><span class="op">+</span><span class="st">     &quot;bmi&quot;</span>, <span class="st">&quot;currsmoker&quot;</span>, <span class="st">&quot;msrenaldis&quot;</span>, <span class="st">&quot;numdisvessels&quot;</span>, <span class="st">&quot;intrapostmi&quot;</span>)</span>
<span id="cb112-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-6"></a><span class="op">&gt;</span><span class="st"> </span>myform2 &lt;-<span class="st"> </span><span class="kw">formulize</span>(<span class="dt">y =</span> <span class="st">&quot;dischargestatus01&quot;</span>, <span class="dt">x =</span> covar2)</span>
<span id="cb112-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-7"></a><span class="op">&gt;</span><span class="st"> </span>tmp2 &lt;-<span class="st"> </span><span class="kw">modelsum</span>(myform2, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="dt">data =</span> d1)</span>
<span id="cb112-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb112-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(tmp2, <span class="dt">show.intercept =</span> F, <span class="dt">title =</span> <span class="st">&quot;Hospital Discharge: Univariate analysis&quot;</span>)</span></code></pre></div>
<table>
<caption>Hospital Discharge: Univariate analysis</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">OR</th>
<th align="left">CI.lower.OR</th>
<th align="left">CI.upper.OR</th>
<th align="left">p.value</th>
<th align="left">concordance</th>
<th align="left">Nmiss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Age, yrs</strong></td>
<td align="left">1.020</td>
<td align="left">0.986</td>
<td align="left">1.057</td>
<td align="left">0.259</td>
<td align="left">0.555</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left"><strong>Gender Male</strong></td>
<td align="left">2.098</td>
<td align="left">0.790</td>
<td align="left">7.236</td>
<td align="left">0.178</td>
<td align="left">0.564</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left"><strong>as.numeric(recentmi)</strong></td>
<td align="left">2.236</td>
<td align="left">1.547</td>
<td align="left">3.426</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.742</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left"><strong>cardioshock Yes</strong></td>
<td align="left">91.915</td>
<td align="left">36.761</td>
<td align="left">262.524</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.855</td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="left"><strong>diabetes Yes</strong></td>
<td align="left">0.978</td>
<td align="left">0.347</td>
<td align="left">2.418</td>
<td align="left">0.963</td>
<td align="left">0.502</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left"><strong>hypertension Yes</strong></td>
<td align="left">0.415</td>
<td align="left">0.157</td>
<td align="left">1.213</td>
<td align="left">0.086</td>
<td align="left">0.584</td>
<td align="left">72</td>
</tr>
<tr class="odd">
<td align="left"><strong>Body Mass Index (kg/sq.m)</strong></td>
<td align="left">0.934</td>
<td align="left">0.860</td>
<td align="left">1.007</td>
<td align="left">0.094</td>
<td align="left">0.588</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left"><strong>currsmoker Yes</strong></td>
<td align="left">1.982</td>
<td align="left">0.697</td>
<td align="left">4.978</td>
<td align="left">0.164</td>
<td align="left">0.561</td>
<td align="left">68</td>
</tr>
<tr class="odd">
<td align="left"><strong>msrenaldis Yes</strong></td>
<td align="left">1.038</td>
<td align="left">0.058</td>
<td align="left">5.067</td>
<td align="left">0.971</td>
<td align="left">0.501</td>
<td align="left">20</td>
</tr>
<tr class="even">
<td align="left"><strong>Number of diseased vessels</strong></td>
<td align="left">1.407</td>
<td align="left">0.880</td>
<td align="left">2.270</td>
<td align="left">0.154</td>
<td align="left">0.577</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="left"><strong>intrapostmi Yes</strong></td>
<td align="left">2.370</td>
<td align="left">0.375</td>
<td align="left">8.251</td>
<td align="left">0.249</td>
<td align="left">0.523</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># save results as a data frame and output results to a csv file</span></span>
<span id="cb113-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-2"></a><span class="er">&gt;</span><span class="st"> </span>foroutput &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(tmp)</span>
<span id="cb113-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(foroutput)</span>
<span id="cb113-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-4"></a>             y.term           y.label strata.term adjustment model        term</span>
<span id="cb113-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-5"></a><span class="dv">1</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">1</span> (Intercept)</span>
<span id="cb113-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-6"></a><span class="dv">2</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">1</span>         age</span>
<span id="cb113-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-7"></a><span class="dv">3</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">2</span> (Intercept)</span>
<span id="cb113-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-8"></a><span class="dv">4</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">2</span>  genderMale</span>
<span id="cb113-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-9"></a><span class="dv">5</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">3</span> (Intercept)</span>
<span id="cb113-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-10"></a><span class="dv">6</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">3</span>  recentmi.L</span>
<span id="cb113-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-11"></a>        label term.type          OR  CI.lower.OR CI.upper.OR      p.value</span>
<span id="cb113-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-12"></a><span class="dv">1</span> (Intercept) Intercept <span class="fl">0.003153183</span> <span class="fl">0.0002420665</span>  <span class="fl">0.03147134</span> <span class="fl">3.184984e-06</span></span>
<span id="cb113-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-13"></a><span class="dv">2</span>    Age, yrs      Term <span class="fl">1.020021318</span> <span class="fl">0.9861477653</span>  <span class="fl">1.05679269</span> <span class="fl">2.592280e-01</span></span>
<span id="cb113-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-14"></a><span class="dv">3</span> (Intercept) Intercept <span class="fl">0.006849315</span> <span class="fl">0.0021209595</span>  <span class="fl">0.01598169</span> <span class="fl">2.943694e-23</span></span>
<span id="cb113-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-15"></a><span class="dv">4</span> Gender Male      Term <span class="fl">2.097701072</span> <span class="fl">0.7897245602</span>  <span class="fl">7.23552308</span> <span class="fl">1.778864e-01</span></span>
<span id="cb113-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-16"></a><span class="dv">5</span> (Intercept) Intercept <span class="fl">0.009989839</span> <span class="fl">0.0055506795</span>  <span class="fl">0.01593187</span> <span class="fl">3.116393e-68</span></span>
<span id="cb113-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-17"></a><span class="dv">6</span> recentmi .L      Term <span class="fl">5.914143128</span> <span class="fl">2.5537218993</span> <span class="fl">16.88340502</span> <span class="fl">1.463148e-04</span></span>
<span id="cb113-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-18"></a>  concordance Nmiss</span>
<span id="cb113-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-19"></a><span class="dv">1</span>   <span class="fl">0.5550038</span>     <span class="dv">0</span></span>
<span id="cb113-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-20"></a><span class="dv">2</span>   <span class="fl">0.5550038</span>     <span class="dv">0</span></span>
<span id="cb113-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-21"></a><span class="dv">3</span>   <span class="fl">0.5644399</span>     <span class="dv">0</span></span>
<span id="cb113-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-22"></a><span class="dv">4</span>   <span class="fl">0.5644399</span>     <span class="dv">0</span></span>
<span id="cb113-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-23"></a><span class="dv">5</span>   <span class="fl">0.7420966</span>    <span class="dv">28</span></span>
<span id="cb113-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-24"></a><span class="dv">6</span>   <span class="fl">0.7420966</span>    <span class="dv">28</span></span>
<span id="cb113-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb113-25"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">write.csv</span>(foroutput, <span class="dt">file =</span> <span class="st">&quot;~/ibm/testoutput.csv&quot;</span>)</span></code></pre></div>
<p>You can also use <code>modelsum</code> to look at results after adjusting for variables such as age and gender.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb114-1"></a><span class="op">&gt;</span><span class="st"> </span>tmp2 &lt;-<span class="st"> </span><span class="kw">modelsum</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(recentmi) <span class="op">+</span><span class="st"> </span>cardioshock, <span class="dt">adjust =</span> <span class="op">~</span>age <span class="op">+</span><span class="st"> </span></span>
<span id="cb114-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb114-2"></a><span class="op">+</span><span class="st">     </span>gender, <span class="dt">data =</span> d1, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb114-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb114-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(tmp2, <span class="dt">show.intercept =</span> F, <span class="dt">show.adjust =</span> F, <span class="dt">title =</span> <span class="st">&quot;Hospital Discharge: Results of key variables after adjusting for age and gender&quot;</span>)</span></code></pre></div>
<table>
<caption>Hospital Discharge: Results of key variables after adjusting for age and gender</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">OR</th>
<th align="left">CI.lower.OR</th>
<th align="left">CI.upper.OR</th>
<th align="left">p.value</th>
<th align="left">concordance</th>
<th align="left">Nmiss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>as.numeric(recentmi)</strong></td>
<td align="left">2.333</td>
<td align="left">1.600</td>
<td align="left">3.609</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.784</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left"><strong>cardioshock Yes</strong></td>
<td align="left">103.312</td>
<td align="left">40.588</td>
<td align="left">300.457</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.863</td>
<td align="left">4</td>
</tr>
</tbody>
</table>
<p>Alternative code for looping through variables is shown at the <a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#alt-loop">end of this document</a>.</p>
<p>You might also want to look at the functional form of age as it relates to the endpoint. The <code>termplot()</code> function is a quick way to see if there are indications that the relationship may be non-linear. Here we used the spline function <code>ns()</code> with 3 degrees of freedom to look for non-linearity.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb115-1"></a><span class="op">&gt;</span><span class="st"> </span>fit4 &lt;-<span class="st"> </span><span class="kw">glm</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>), <span class="dt">data =</span> d1, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb115-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb115-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">termplot</span>(fit4, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-16-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(fit4)</span>
<span id="cb116-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-2"></a></span>
<span id="cb116-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-3"></a>Call<span class="op">:</span></span>
<span id="cb116-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-4"></a><span class="kw">glm</span>(<span class="dt">formula =</span> dischargestatus01 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>), <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb116-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-5"></a>    <span class="dt">data =</span> d1)</span>
<span id="cb116-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-6"></a></span>
<span id="cb116-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-7"></a>Deviance Residuals<span class="op">:</span><span class="st"> </span></span>
<span id="cb116-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-8"></a><span class="st">    </span>Min       1Q   Median       3Q      Max  </span>
<span id="cb116-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-9"></a><span class="fl">-0.4171</span>  <span class="fl">-0.1704</span>  <span class="fl">-0.1521</span>  <span class="fl">-0.1415</span>   <span class="fl">3.2127</span>  </span>
<span id="cb116-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-10"></a></span>
<span id="cb116-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-11"></a>Coefficients<span class="op">:</span></span>
<span id="cb116-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-12"></a><span class="st">                 </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)  </span>
<span id="cb116-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-13"></a>(Intercept)       <span class="fl">-10.895</span>      <span class="fl">4.758</span>  <span class="fl">-2.290</span>   <span class="fl">0.0220</span> <span class="op">*</span></span>
<span id="cb116-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-14"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">1</span>    <span class="fl">2.789</span>      <span class="fl">2.489</span>   <span class="fl">1.120</span>   <span class="fl">0.2626</span>  </span>
<span id="cb116-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-15"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">2</span>   <span class="fl">14.263</span>      <span class="fl">9.827</span>   <span class="fl">1.451</span>   <span class="fl">0.1467</span>  </span>
<span id="cb116-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-16"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="dv">3</span>    <span class="fl">4.356</span>      <span class="fl">2.441</span>   <span class="fl">1.784</span>   <span class="fl">0.0744</span> .</span>
<span id="cb116-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-17"></a><span class="op">---</span></span>
<span id="cb116-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-18"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb116-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-19"></a></span>
<span id="cb116-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-20"></a>(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</span>
<span id="cb116-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-21"></a></span>
<span id="cb116-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-22"></a>    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">260.01</span>  on <span class="dv">1999</span>  degrees of freedom</span>
<span id="cb116-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-23"></a>Residual deviance<span class="op">:</span><span class="st"> </span><span class="fl">256.00</span>  on <span class="dv">1996</span>  degrees of freedom</span>
<span id="cb116-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-24"></a>AIC<span class="op">:</span><span class="st"> </span><span class="dv">264</span></span>
<span id="cb116-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-25"></a></span>
<span id="cb116-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-26"></a>Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">8</span></span>
<span id="cb116-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-27"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(fit4, <span class="dt">test =</span> <span class="st">&quot;Chi&quot;</span>)</span>
<span id="cb116-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-28"></a>Analysis of Deviance Table</span>
<span id="cb116-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-29"></a></span>
<span id="cb116-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-30"></a>Model<span class="op">:</span><span class="st"> </span>binomial, link<span class="op">:</span><span class="st"> </span>logit</span>
<span id="cb116-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-31"></a></span>
<span id="cb116-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-32"></a>Response<span class="op">:</span><span class="st"> </span>dischargestatus01</span>
<span id="cb116-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-33"></a></span>
<span id="cb116-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-34"></a>Terms added <span class="kw">sequentially</span> (first to last)</span>
<span id="cb116-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-35"></a></span>
<span id="cb116-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-36"></a>                Df Deviance Resid. Df Resid. Dev <span class="kw">Pr</span>(<span class="op">&gt;</span>Chi)</span>
<span id="cb116-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-37"></a><span class="ot">NULL</span>                             <span class="dv">1999</span>     <span class="fl">260.01</span>         </span>
<span id="cb116-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-38"></a><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)  <span class="dv">3</span>   <span class="fl">4.0076</span>      <span class="dv">1996</span>     <span class="fl">256.00</span>   <span class="fl">0.2606</span></span>
<span id="cb116-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-39"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb116-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-40"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Test whether non-linearity is significant by comparing to linear model</span></span>
<span id="cb116-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-41"></a><span class="er">&gt;</span><span class="st"> </span>fit5 &lt;-<span class="st"> </span><span class="kw">glm</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> d1, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb116-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-42"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(fit5, fit4, <span class="dt">test =</span> <span class="st">&quot;Chi&quot;</span>)</span>
<span id="cb116-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-43"></a>Analysis of Deviance Table</span>
<span id="cb116-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-44"></a></span>
<span id="cb116-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-45"></a>Model <span class="dv">1</span><span class="op">:</span><span class="st"> </span>dischargestatus01 <span class="op">~</span><span class="st"> </span>age</span>
<span id="cb116-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-46"></a>Model <span class="dv">2</span><span class="op">:</span><span class="st"> </span>dischargestatus01 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)</span>
<span id="cb116-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-47"></a>  Resid. Df Resid. Dev Df Deviance <span class="kw">Pr</span>(<span class="op">&gt;</span>Chi)</span>
<span id="cb116-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-48"></a><span class="dv">1</span>      <span class="dv">1998</span>      <span class="fl">258.7</span>                     </span>
<span id="cb116-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb116-49"></a><span class="dv">2</span>      <span class="dv">1996</span>      <span class="fl">256.0</span>  <span class="dv">2</span>   <span class="fl">2.7026</span>   <span class="fl">0.2589</span></span></code></pre></div>
</div>
<div id="cox-regression-models" class="section level3">
<h3><span class="header-section-number">2.2.7</span> Cox regression models</h3>
<p>Assess which risk factors predict the endpoint <code>tm2death</code>.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># First, a simple model for gender only</span></span>
<span id="cb117-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-2"></a><span class="er">&gt;</span><span class="st"> </span>fit6 &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb117-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(fit6)</span>
<span id="cb117-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-4"></a>Call<span class="op">:</span></span>
<span id="cb117-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-5"></a><span class="kw">coxph</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>gender, <span class="dt">data =</span> d1)</span>
<span id="cb117-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-6"></a></span>
<span id="cb117-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-7"></a>  n=<span class="st"> </span><span class="dv">2000</span>, number of events=<span class="st"> </span><span class="dv">608</span> </span>
<span id="cb117-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-8"></a></span>
<span id="cb117-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-9"></a>              coef <span class="kw">exp</span>(coef) <span class="kw">se</span>(coef)      z <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)  </span>
<span id="cb117-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-10"></a>genderMale <span class="fl">-0.2029</span>    <span class="fl">0.8163</span>   <span class="fl">0.0856</span> <span class="fl">-2.371</span>   <span class="fl">0.0177</span> <span class="op">*</span></span>
<span id="cb117-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-11"></a><span class="op">---</span></span>
<span id="cb117-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-12"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb117-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-13"></a></span>
<span id="cb117-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-14"></a>           <span class="kw">exp</span>(coef) <span class="kw">exp</span>(<span class="op">-</span>coef) lower <span class="fl">.95</span> upper <span class="fl">.95</span></span>
<span id="cb117-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-15"></a>genderMale    <span class="fl">0.8163</span>      <span class="fl">1.225</span>    <span class="fl">0.6902</span>    <span class="fl">0.9654</span></span>
<span id="cb117-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-16"></a></span>
<span id="cb117-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-17"></a>Concordance=<span class="st"> </span><span class="fl">0.517</span>  (<span class="dt">se =</span> <span class="fl">0.01</span> )</span>
<span id="cb117-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-18"></a>Likelihood ratio test=<span class="st"> </span><span class="fl">5.49</span>  on <span class="dv">1</span> df,   p=<span class="fl">0.02</span></span>
<span id="cb117-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-19"></a>Wald test            =<span class="st"> </span><span class="fl">5.62</span>  on <span class="dv">1</span> df,   p=<span class="fl">0.02</span></span>
<span id="cb117-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb117-20"></a><span class="kw">Score</span> (logrank) test =<span class="st"> </span><span class="fl">5.64</span>  on <span class="dv">1</span> df,   p=<span class="fl">0.02</span></span></code></pre></div>
<p>The <code>broom</code> package can be used with survival objects as well.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Look at a tidy model summary (data frame)</span></span>
<span id="cb118-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-2"></a><span class="er">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">tidy</span>(fit6, <span class="dt">exponentiate =</span> <span class="ot">TRUE</span>, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span>
<span id="cb118-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(tmp, <span class="dt">digits =</span> <span class="dv">3</span>)</span>
<span id="cb118-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-4"></a><span class="co"># A tibble: 1 x 7</span></span>
<span id="cb118-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-5"></a>  term       estimate std.error statistic p.value conf.low conf.high</span>
<span id="cb118-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-6"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb118-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-7"></a><span class="dv">1</span> genderMale    <span class="fl">0.816</span>    <span class="fl">0.0856</span>     <span class="fl">-2.37</span>  <span class="fl">0.0177</span>    <span class="fl">0.690</span>     <span class="fl">0.965</span></span>
<span id="cb118-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">glance</span>(fit6)</span>
<span id="cb118-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-9"></a><span class="co"># A tibble: 1 x 15</span></span>
<span id="cb118-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-10"></a>      n nevent statistic.log p.value.log statistic.sc p.value.sc statistic.wald</span>
<span id="cb118-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-11"></a>  <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">        </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb118-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-12"></a><span class="dv">1</span>  <span class="dv">2000</span>    <span class="dv">608</span>          <span class="fl">5.49</span>      <span class="fl">0.0191</span>         <span class="fl">5.64</span>     <span class="fl">0.0176</span>           <span class="fl">5.62</span></span>
<span id="cb118-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-13"></a><span class="co"># … with 8 more variables: p.value.wald &lt;dbl&gt;, r.squared &lt;dbl&gt;,</span></span>
<span id="cb118-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-14"></a><span class="co">#   r.squared.max &lt;dbl&gt;, concordance &lt;dbl&gt;, std.error.concordance &lt;dbl&gt;,</span></span>
<span id="cb118-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb118-15"></a><span class="co">#   logLik &lt;dbl&gt;, AIC &lt;dbl&gt;, BIC &lt;dbl&gt;</span></span></code></pre></div>
<p>Here is how you would use <code>modelsum()</code> for Cox models.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb119-1"></a><span class="op">&gt;</span><span class="st"> </span>myform &lt;-<span class="st"> </span><span class="kw">formulize</span>(<span class="dt">y =</span> <span class="st">&quot;Surv(tm2death, s.death)&quot;</span>, <span class="dt">x =</span> covar2)</span>
<span id="cb119-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb119-2"></a><span class="op">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">modelsum</span>(myform, <span class="dt">family =</span> <span class="st">&quot;survival&quot;</span>, <span class="dt">data =</span> d1)</span>
<span id="cb119-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb119-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(tmp, <span class="dt">show.intercept =</span> F, <span class="dt">title =</span> <span class="st">&quot;Overall survival: Univariate analysis&quot;</span>)</span></code></pre></div>
<table>
<caption>Overall survival: Univariate analysis</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">HR</th>
<th align="left">CI.lower.HR</th>
<th align="left">CI.upper.HR</th>
<th align="left">p.value</th>
<th align="left">concordance</th>
<th align="left">Nmiss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Age, yrs</strong></td>
<td align="left">1.062</td>
<td align="left">1.054</td>
<td align="left">1.070</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.663</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left"><strong>Gender Male</strong></td>
<td align="left">0.816</td>
<td align="left">0.690</td>
<td align="left">0.965</td>
<td align="left">0.018</td>
<td align="left">0.517</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left"><strong>as.numeric(recentmi)</strong></td>
<td align="left">1.093</td>
<td align="left">1.024</td>
<td align="left">1.167</td>
<td align="left">0.008</td>
<td align="left">0.550</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left"><strong>cardioshock Yes</strong></td>
<td align="left">2.290</td>
<td align="left">1.649</td>
<td align="left">3.181</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.526</td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="left"><strong>diabetes Yes</strong></td>
<td align="left">2.207</td>
<td align="left">1.876</td>
<td align="left">2.597</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.586</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left"><strong>hypertension Yes</strong></td>
<td align="left">2.140</td>
<td align="left">1.653</td>
<td align="left">2.770</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.546</td>
<td align="left">72</td>
</tr>
<tr class="odd">
<td align="left"><strong>Body Mass Index (kg/sq.m)</strong></td>
<td align="left">0.984</td>
<td align="left">0.970</td>
<td align="left">0.998</td>
<td align="left">0.022</td>
<td align="left">0.535</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left"><strong>currsmoker Yes</strong></td>
<td align="left">0.659</td>
<td align="left">0.514</td>
<td align="left">0.845</td>
<td align="left">0.001</td>
<td align="left">0.525</td>
<td align="left">68</td>
</tr>
<tr class="odd">
<td align="left"><strong>msrenaldis Yes</strong></td>
<td align="left">4.026</td>
<td align="left">3.116</td>
<td align="left">5.202</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.543</td>
<td align="left">20</td>
</tr>
<tr class="even">
<td align="left"><strong>Number of diseased vessels</strong></td>
<td align="left">1.572</td>
<td align="left">1.434</td>
<td align="left">1.724</td>
<td align="left">&lt; 0.001</td>
<td align="left">0.607</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="left"><strong>intrapostmi Yes</strong></td>
<td align="left">1.028</td>
<td align="left">0.672</td>
<td align="left">1.573</td>
<td align="left">0.899</td>
<td align="left">0.503</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>You might also want to look at the functional form of age as it relates to the endpoint. The <code>termplot()</code> function is a quick way to see if there are indications that the relationship may be non-linear. Here we used the penalized spline <code>pspline()</code> with 4 degrees of freedom to look for non-linearity.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb120-1"></a><span class="op">&gt;</span><span class="st"> </span>fit7 &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span><span class="kw">pspline</span>(age, <span class="dt">df =</span> <span class="dv">4</span>), <span class="dt">data =</span> d1)</span>
<span id="cb120-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb120-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">termplot</span>(fit7, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-19-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-1"></a><span class="op">&gt;</span><span class="st"> </span>fit7  <span class="co"># test linear and nonlinear portions of the fit for significance</span></span>
<span id="cb121-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-2"></a>Call<span class="op">:</span></span>
<span id="cb121-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-3"></a><span class="kw">coxph</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span><span class="kw">pspline</span>(age, <span class="dt">df =</span> <span class="dv">4</span>), </span>
<span id="cb121-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-4"></a>    <span class="dt">data =</span> d1)</span>
<span id="cb121-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-5"></a></span>
<span id="cb121-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-6"></a>                              coef <span class="kw">se</span>(coef)      se2    Chisq   DF      p</span>
<span id="cb121-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-7"></a><span class="kw">pspline</span>(age, <span class="dt">df =</span> <span class="dv">4</span>), lin <span class="fl">5.93e-02</span> <span class="fl">3.69e-03</span> <span class="fl">3.69e-03</span> <span class="fl">2.58e+02</span> <span class="fl">1.00</span> <span class="op">&lt;</span><span class="fl">2e-16</span></span>
<span id="cb121-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-8"></a><span class="kw">pspline</span>(age, <span class="dt">df =</span> <span class="dv">4</span>), non                            <span class="fl">9.61e+00</span> <span class="fl">3.07</span>  <span class="fl">0.024</span></span>
<span id="cb121-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-9"></a></span>
<span id="cb121-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-10"></a>Iterations<span class="op">:</span><span class="st"> </span><span class="dv">5</span> outer, <span class="dv">15</span> Newton<span class="op">-</span>Raphson</span>
<span id="cb121-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-11"></a>     Theta=<span class="st"> </span><span class="fl">0.88</span> </span>
<span id="cb121-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-12"></a>Degrees of freedom <span class="cf">for</span> terms=<span class="st"> </span><span class="fl">4.1</span> </span>
<span id="cb121-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-13"></a>Likelihood ratio test=<span class="dv">269</span>  on <span class="fl">4.07</span> df, p=<span class="er">&lt;</span><span class="fl">2e-16</span></span>
<span id="cb121-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-14"></a>n=<span class="st"> </span><span class="dv">2000</span>, number of events=<span class="st"> </span><span class="dv">608</span> </span>
<span id="cb121-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-15"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(fit7)  <span class="co"># overall test</span></span>
<span id="cb121-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-16"></a>Analysis of Deviance Table</span>
<span id="cb121-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-17"></a> Cox model<span class="op">:</span><span class="st"> </span>response is <span class="kw">Surv</span>(tm2death, s.death)</span>
<span id="cb121-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-18"></a>Terms added <span class="kw">sequentially</span> (first to last)</span>
<span id="cb121-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-19"></a></span>
<span id="cb121-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-20"></a>                      loglik  Chisq     Df <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>Chi<span class="op">|</span>)    </span>
<span id="cb121-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-21"></a><span class="ot">NULL</span>                 <span class="fl">-4324.7</span>                             </span>
<span id="cb121-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-22"></a><span class="kw">pspline</span>(age, <span class="dt">df =</span> <span class="dv">4</span>) <span class="fl">-4190.1</span> <span class="fl">269.33</span> <span class="fl">4.0686</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2.2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb121-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-23"></a><span class="op">---</span></span>
<span id="cb121-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb121-24"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<p>Finally, it is good to do some basic model checks on your results. The coefficient in a Cox model is an average of the estimated beta over all the event times. The proportional hazards model assumes that this coefficient is constant over time, however that is not always true. The <code>cox.zph</code> function creates time-dependent coefficients for more detailed examination. The printout of <code>cox.zph</code> summarizes the correlation of Beta(time) vs time for each variable. The plot of <code>cox.zph</code> visualizes the relationship. It is important to look at the plot to understand the summary.</p>
<p>In the <code>coxph</code> function, as with some (but not all) of the other model functions in R, there are several options for handling missing values. The default <code>na.omit</code> option and the <code>na.exclude</code> option both remove any missing values from the fit. They differ in that the former returns residuals only for the non-missing values and the latter returns residuals with the same number of rows as the input data. If you want to compare residuals to the original data then it is more convenient to use <code>na.exclude</code> (not the default); if you are going to calculate summaries such as quantiles then the former is more convenient because missing values will have been removed.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Change option because we will want to look at residuals later on</span></span>
<span id="cb122-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">options</span>(<span class="dt">na.action =</span> na.exclude)</span>
<span id="cb122-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-3"></a><span class="op">&gt;</span><span class="st"> </span>fit8 &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>cardioshock, <span class="dt">data =</span> d1)</span>
<span id="cb122-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-4"></a><span class="op">&gt;</span><span class="st"> </span>zfit8 &lt;-<span class="st"> </span><span class="kw">cox.zph</span>(fit8)</span>
<span id="cb122-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb122-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-6"></a><span class="er">&gt;</span><span class="st"> </span>zfit8</span>
<span id="cb122-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-7"></a>            chisq df       p</span>
<span id="cb122-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-8"></a>age          <span class="fl">40.0</span>  <span class="dv">1</span> <span class="fl">2.5e-10</span></span>
<span id="cb122-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-9"></a>gender        <span class="fl">1.5</span>  <span class="dv">1</span>    <span class="fl">0.22</span></span>
<span id="cb122-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-10"></a>cardioshock  <span class="fl">27.6</span>  <span class="dv">1</span> <span class="fl">1.5e-07</span></span>
<span id="cb122-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-11"></a>GLOBAL       <span class="fl">65.3</span>  <span class="dv">3</span> <span class="fl">4.3e-14</span></span>
<span id="cb122-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb122-12"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(zfit8[<span class="dv">3</span>])  <span class="co"># look at 3rd variable, hard to view</span></span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb123-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(zfit8[<span class="dv">3</span>], <span class="dt">resid =</span> <span class="ot">FALSE</span>)  <span class="co"># plot without residuals</span></span>
<span id="cb123-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb123-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">coef</span>(fit8)[<span class="dv">3</span>], <span class="dt">col =</span> <span class="dv">2</span>)  <span class="co"># coef estimate</span></span>
<span id="cb123-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb123-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-20-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Based on this, it appears that we might need to treat early deaths (likely those in the hospital) different from those that appear after discharge. Perhaps we might want to start follow-up after discharge if that information is available.</p>
<p>Leverage points are also sometimes an issue. Dfbeta residuals offer one way to check for influential points. It allows you to see how much the estimate of Beta would change if one point was deleted.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-1"></a><span class="op">&gt;</span><span class="st"> </span>rr &lt;-<span class="st"> </span><span class="kw">resid</span>(fit8, <span class="dt">type =</span> <span class="st">&quot;dfbeta&quot;</span>)</span>
<span id="cb124-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dim</span>(rr)</span>
<span id="cb124-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-3"></a>[<span class="dv">1</span>] <span class="dv">2000</span>    <span class="dv">3</span></span>
<span id="cb124-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb124-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># color by status - residuals are all in the 4th decimal so nothing too large</span></span>
<span id="cb124-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb124-6"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">plot</span>(d1<span class="op">$</span>age, rr[, <span class="dv">1</span>], <span class="dt">col =</span> d1<span class="op">$</span>s.death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="02-scenario2_files/figure-html/unnamed-chunk-21-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="missingness-revisited-imputation" class="section level3">
<h3><span class="header-section-number">2.2.8</span> Missingness revisited: Imputation</h3>
<p>There are multiple packages that do multiple imputation in R (see <a href="https://www.analyticsvidhya.com/blog/2016/03/tutorial-powerful-packages-imputing-missing-values/">article</a> for review). In the code below we’ve chosen to use the <code>mice</code> package (Multivariate Imputation via Chained Equations).</p>
<p>Recommendations:
* need to include the endpoint in the imputation
* if using multiple models/endpoints, just impute everything once including all the variables
* imputing continuous variables is much easier than categorical
- The default “mice” method is predictive mean matching (pmm) for numeric variables, logistic
regression (logreg) for two level factors, polytomous regression (polyreg) for unordered
categorical variables, and proportional odds regression (polyr) for ordered factors.
You can also specify different methods for different variables within the same call.
- The mice package does not like dates
- Other methods for imputation are also available besides these defaults</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(mice)</span>
<span id="cb125-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-2"></a></span>
<span id="cb125-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-3"></a>Attaching package<span class="op">:</span><span class="st"> &#39;mice&#39;</span></span>
<span id="cb125-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-4"></a>The following objects are masked from <span class="st">&#39;package:base&#39;</span><span class="op">:</span></span>
<span id="cb125-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-5"></a></span>
<span id="cb125-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-6"></a><span class="st">    </span>cbind, rbind</span>
<span id="cb125-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb125-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-8"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb125-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-9"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Create data frame &#39;sub&#39; which excludes date variables, status variables and id</span></span>
<span id="cb125-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-10"></a><span class="er">&gt;</span><span class="st"> </span>sub &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;dt&quot;</span>), <span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;s.&quot;</span>), <span class="op">-</span>id)</span>
<span id="cb125-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-11"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Create 5 imputed datasets</span></span>
<span id="cb125-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-12"></a><span class="er">&gt;</span><span class="st"> </span>imputed_d1 &lt;-<span class="st"> </span><span class="kw">mice</span>(sub, <span class="dt">m =</span> <span class="dv">5</span>, <span class="dt">printFlag =</span> <span class="ot">FALSE</span>, <span class="dt">set.seed =</span> <span class="dv">123</span>)  <span class="co"># create 5 datasets, don&#39;t print log</span></span>
<span id="cb125-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-13"></a>Warning<span class="op">:</span><span class="st"> </span>Number of logged events<span class="op">:</span><span class="st"> </span><span class="dv">3</span></span>
<span id="cb125-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-14"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb125-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-15"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># fit multiple models with imputed data, then combine the results</span></span>
<span id="cb125-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-16"></a><span class="er">&gt;</span><span class="st"> </span>fits &lt;-<span class="st"> </span><span class="kw">with</span>(imputed_d1, <span class="kw">glm</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span>diabetes, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb125-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-17"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb125-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-18"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Pool function combines the results of the 5 imputed datasets</span></span>
<span id="cb125-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-19"></a><span class="er">&gt;</span><span class="st"> </span>pool.fits &lt;-<span class="st"> </span><span class="kw">pool</span>(fits)</span>
<span id="cb125-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-20"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(pool.fits)</span>
<span id="cb125-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-21"></a>         term   estimate std.error   statistic        df   p.value</span>
<span id="cb125-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-22"></a><span class="dv">1</span> (Intercept) <span class="fl">-4.3768615</span> <span class="fl">0.2422715</span> <span class="fl">-18.0659339</span> <span class="fl">1662.3695</span> <span class="fl">0.0000000</span></span>
<span id="cb125-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-23"></a><span class="dv">2</span> diabetesYes <span class="fl">-0.1254765</span> <span class="fl">0.4814559</span>  <span class="fl">-0.2606188</span>  <span class="fl">612.7132</span> <span class="fl">0.7944741</span></span>
<span id="cb125-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-24"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># fmi = fraction of information about the coefficients missing due to nonresponse</span></span>
<span id="cb125-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-25"></a><span class="er">&gt;</span><span class="st"> </span></span>
<span id="cb125-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-26"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># original value</span></span>
<span id="cb125-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-27"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(<span class="kw">glm</span>(dischargestatus01 <span class="op">~</span><span class="st"> </span>diabetes, <span class="dt">data =</span> d1, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb125-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-28"></a><span class="co"># A tibble: 2 x 5</span></span>
<span id="cb125-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-29"></a>  term        estimate std.error statistic  p.value</span>
<span id="cb125-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-30"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb125-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-31"></a><span class="dv">1</span> (Intercept)  <span class="fl">-4.53</span>       <span class="fl">0.260</span>  <span class="fl">-17.5</span>    <span class="fl">3.13e-68</span></span>
<span id="cb125-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb125-32"></a><span class="dv">2</span> diabetesYes  <span class="fl">-0.0227</span>     <span class="fl">0.486</span>   <span class="fl">-0.0468</span> <span class="fl">9.63</span>e<span class="op">-</span><span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>This is fine for 1 variable, but what if you want to look at multiple models using the imputed data?</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># create a list with 5 elements, each housing one of the new datasets</span></span>
<span id="cb126-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-2"></a><span class="er">&gt;</span><span class="st"> </span>imp.list &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb126-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {</span>
<span id="cb126-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-4"></a><span class="op">+</span><span class="st">     </span>tmp &lt;-<span class="st"> </span><span class="kw">complete</span>(imputed_d1, <span class="dt">action =</span> i)</span>
<span id="cb126-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-5"></a><span class="op">+</span><span class="st">     </span>imp.list[[i]] &lt;-<span class="st"> </span>tmp</span>
<span id="cb126-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-6"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb126-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-8"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># run modelsum on each element of the list, store as a dataframe (again an</span></span>
<span id="cb126-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-9"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># element of a list)</span></span>
<span id="cb126-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-10"></a><span class="er">&gt;</span><span class="st"> </span>myform &lt;-<span class="st"> </span><span class="kw">formulize</span>(<span class="dt">y =</span> <span class="st">&quot;dischargestatus01&quot;</span>, <span class="dt">x =</span> covar)</span>
<span id="cb126-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-11"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-12"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Write function to return modelsum results as a data frame</span></span>
<span id="cb126-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-13"></a><span class="er">&gt;</span><span class="st"> </span>myfun &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb126-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-14"></a><span class="op">+</span><span class="st">     </span>fit &lt;-<span class="st"> </span><span class="kw">modelsum</span>(myform, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="dt">data =</span> x, <span class="dt">show.intercept =</span> <span class="ot">FALSE</span>, </span>
<span id="cb126-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-15"></a><span class="op">+</span><span class="st">         </span><span class="dt">binomial.stats =</span> <span class="kw">c</span>(<span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;std.error&quot;</span>, <span class="st">&quot;p.value&quot;</span>, <span class="st">&quot;concordance&quot;</span>, <span class="st">&quot;Nmiss&quot;</span>))</span>
<span id="cb126-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-16"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">as.data.frame</span>(fit))</span>
<span id="cb126-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-17"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb126-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-18"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-19"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># For each element in the list (each imputed dataset), run myfun()</span></span>
<span id="cb126-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-20"></a><span class="er">&gt;</span><span class="st"> </span>tmp &lt;-<span class="st"> </span><span class="kw">lapply</span>(imp.list, myfun)</span>
<span id="cb126-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-21"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(tmp[[<span class="dv">1</span>]])</span>
<span id="cb126-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-22"></a>             y.term           y.label strata.term adjustment model</span>
<span id="cb126-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-23"></a><span class="dv">1</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">1</span></span>
<span id="cb126-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-24"></a><span class="dv">2</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">2</span></span>
<span id="cb126-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-25"></a><span class="dv">3</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">3</span></span>
<span id="cb126-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-26"></a><span class="dv">4</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">3</span></span>
<span id="cb126-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-27"></a><span class="dv">5</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">3</span></span>
<span id="cb126-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-28"></a><span class="dv">6</span> dischargestatus01 dischargestatus01             unadjusted     <span class="dv">4</span></span>
<span id="cb126-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-29"></a>            term           label term.type    estimate  std.error      p.value</span>
<span id="cb126-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-30"></a><span class="dv">1</span>            age        Age, yrs      Term  <span class="fl">0.01982353</span> <span class="fl">0.01757066</span> <span class="fl">2.592280e-01</span></span>
<span id="cb126-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-31"></a><span class="dv">2</span>     genderMale     Gender Male      Term  <span class="fl">0.74084202</span> <span class="fl">0.54987517</span> <span class="fl">1.778864e-01</span></span>
<span id="cb126-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-32"></a><span class="dv">3</span>     recentmi.L     recentmi .L      Term  <span class="fl">1.77999512</span> <span class="fl">0.46803433</span> <span class="fl">1.428797e-04</span></span>
<span id="cb126-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-33"></a><span class="dv">4</span>     recentmi.Q     recentmi .Q      Term  <span class="fl">0.23067795</span> <span class="fl">0.52772788</span> <span class="fl">6.620277e-01</span></span>
<span id="cb126-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-34"></a><span class="dv">5</span>     recentmi.C     recentmi .C      Term <span class="fl">-0.27538557</span> <span class="fl">0.58132374</span> <span class="fl">6.356985e-01</span></span>
<span id="cb126-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-35"></a><span class="dv">6</span> cardioshockYes cardioshock Yes      Term  <span class="fl">4.57959159</span> <span class="fl">0.48957295</span> <span class="fl">8.418875e-21</span></span>
<span id="cb126-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-36"></a>  concordance</span>
<span id="cb126-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-37"></a><span class="dv">1</span>   <span class="fl">0.5550038</span></span>
<span id="cb126-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-38"></a><span class="dv">2</span>   <span class="fl">0.5644399</span></span>
<span id="cb126-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-39"></a><span class="dv">3</span>   <span class="fl">0.7424089</span></span>
<span id="cb126-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-40"></a><span class="dv">4</span>   <span class="fl">0.7424089</span></span>
<span id="cb126-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-41"></a><span class="dv">5</span>   <span class="fl">0.7424089</span></span>
<span id="cb126-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-42"></a><span class="dv">6</span>   <span class="fl">0.8600709</span></span>
<span id="cb126-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-43"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-44"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># look at coefficients from all the datasets</span></span>
<span id="cb126-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-45"></a><span class="er">&gt;</span><span class="st"> </span></span>
<span id="cb126-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-46"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># Create a list with the estimates from each model</span></span>
<span id="cb126-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-47"></a><span class="er">&gt;</span><span class="st"> </span>model.coef &lt;-<span class="st"> </span><span class="kw">lapply</span>(tmp, <span class="cf">function</span>(x) x<span class="op">$</span>estimate)</span>
<span id="cb126-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-48"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-49"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># use the cbind() function to bind the results together</span></span>
<span id="cb126-50"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-50"></a><span class="er">&gt;</span><span class="st"> </span>model.coef2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind, model.coef)</span>
<span id="cb126-51"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-51"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-52"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-52"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># make this a dataframe</span></span>
<span id="cb126-53"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-53"></a><span class="er">&gt;</span><span class="st"> </span>model.coef3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(model.coef2, <span class="dt">nrow =</span> <span class="kw">nrow</span>(model.coef2), <span class="dt">ncol =</span> <span class="kw">ncol</span>(model.coef2)))</span>
<span id="cb126-54"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-54"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-55"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-55"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># add in rownames for the variables</span></span>
<span id="cb126-56"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-56"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">rownames</span>(model.coef3) &lt;-<span class="st"> </span>tmp[[<span class="dv">1</span>]]<span class="op">$</span>term</span>
<span id="cb126-57"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-57"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-58"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-58"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># label each column as imp1--imp5</span></span>
<span id="cb126-59"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-59"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">colnames</span>(model.coef3) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;imp&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb126-60"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-60"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-61"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-61"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># add in the mean of the 5 columns</span></span>
<span id="cb126-62"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-62"></a><span class="er">&gt;</span><span class="st"> </span>model.coef3<span class="op">$</span>mean.est &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(model.coef3)</span>
<span id="cb126-63"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-63"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb126-64"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb126-64"></a><span class="er">&gt;</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>(model.coef3, <span class="dt">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">imp1</th>
<th align="right">imp2</th>
<th align="right">imp3</th>
<th align="right">imp4</th>
<th align="right">imp5</th>
<th align="right">mean.est</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.020</td>
<td align="right">0.020</td>
<td align="right">0.020</td>
<td align="right">0.020</td>
<td align="right">0.020</td>
<td align="right">0.020</td>
</tr>
<tr class="even">
<td align="left">genderMale</td>
<td align="right">0.741</td>
<td align="right">0.741</td>
<td align="right">0.741</td>
<td align="right">0.741</td>
<td align="right">0.741</td>
<td align="right">0.741</td>
</tr>
<tr class="odd">
<td align="left">recentmi.L</td>
<td align="right">1.780</td>
<td align="right">1.779</td>
<td align="right">1.774</td>
<td align="right">1.773</td>
<td align="right">1.771</td>
<td align="right">1.776</td>
</tr>
<tr class="even">
<td align="left">recentmi.Q</td>
<td align="right">0.231</td>
<td align="right">0.227</td>
<td align="right">0.231</td>
<td align="right">0.225</td>
<td align="right">0.229</td>
<td align="right">0.229</td>
</tr>
<tr class="odd">
<td align="left">recentmi.C</td>
<td align="right">-0.275</td>
<td align="right">-0.286</td>
<td align="right">-0.265</td>
<td align="right">-0.274</td>
<td align="right">-0.274</td>
<td align="right">-0.275</td>
</tr>
<tr class="even">
<td align="left">cardioshockYes</td>
<td align="right">4.580</td>
<td align="right">4.368</td>
<td align="right">4.580</td>
<td align="right">4.368</td>
<td align="right">4.580</td>
<td align="right">4.495</td>
</tr>
<tr class="odd">
<td align="left">diabetesYes</td>
<td align="right">-0.210</td>
<td align="right">0.001</td>
<td align="right">-0.004</td>
<td align="right">-0.206</td>
<td align="right">-0.208</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">hypertensionYes</td>
<td align="right">-1.118</td>
<td align="right">-1.122</td>
<td align="right">-1.298</td>
<td align="right">-1.301</td>
<td align="right">-1.609</td>
<td align="right">-1.289</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">-0.070</td>
<td align="right">-0.067</td>
<td align="right">-0.065</td>
<td align="right">-0.071</td>
<td align="right">-0.074</td>
<td align="right">-0.070</td>
</tr>
<tr class="even">
<td align="left">currsmokerYes</td>
<td align="right">0.448</td>
<td align="right">0.645</td>
<td align="right">0.645</td>
<td align="right">0.649</td>
<td align="right">0.642</td>
<td align="right">0.606</td>
</tr>
<tr class="odd">
<td align="left">msrenaldisYes</td>
<td align="right">-0.127</td>
<td align="right">-0.127</td>
<td align="right">-0.116</td>
<td align="right">-0.127</td>
<td align="right">-0.116</td>
<td align="right">-0.123</td>
</tr>
<tr class="even">
<td align="left">numdisvessels</td>
<td align="right">0.343</td>
<td align="right">0.396</td>
<td align="right">0.344</td>
<td align="right">0.233</td>
<td align="right">0.397</td>
<td align="right">0.343</td>
</tr>
<tr class="odd">
<td align="left">intrapostmiYes</td>
<td align="right">0.863</td>
<td align="right">0.863</td>
<td align="right">0.863</td>
<td align="right">0.863</td>
<td align="right">0.863</td>
<td align="right">0.863</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="resources-1" class="section level2">
<h2><span class="header-section-number">2.3</span> Resources</h2>
<div id="technical-details-1" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Technical details</h3>
<p>Report created: September 22 2020</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Grab session info</span></span>
<span id="cb127-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">sessionInfo</span>()</span>
<span id="cb127-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-3"></a>R version <span class="dv">3</span>.<span class="fl">6.2</span> (<span class="dv">2019-12-12</span>)</span>
<span id="cb127-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-4"></a>Platform<span class="op">:</span><span class="st"> </span>x86_<span class="dv">64</span><span class="op">-</span>pc<span class="op">-</span>linux<span class="op">-</span><span class="kw">gnu</span> (<span class="dv">64</span><span class="op">-</span>bit)</span>
<span id="cb127-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-5"></a>Running under<span class="op">:</span><span class="st"> </span>CentOS Linux <span class="dv">7</span> (Core)</span>
<span id="cb127-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-6"></a></span>
<span id="cb127-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-7"></a>Matrix products<span class="op">:</span><span class="st"> </span>default</span>
<span id="cb127-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-8"></a>BLAS<span class="op">:</span><span class="st">   </span><span class="er">/</span>usr<span class="op">/</span>lib64<span class="op">/</span>libblas.so.<span class="dv">3</span>.<span class="fl">4.2</span></span>
<span id="cb127-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-9"></a>LAPACK<span class="op">:</span><span class="st"> </span><span class="er">/</span>usr<span class="op">/</span>lib64<span class="op">/</span>liblapack.so.<span class="dv">3</span>.<span class="fl">4.2</span></span>
<span id="cb127-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-10"></a></span>
<span id="cb127-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-11"></a>locale<span class="op">:</span></span>
<span id="cb127-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-12"></a><span class="st"> </span>[<span class="dv">1</span>] LC_CTYPE=en_US.UTF<span class="dv">-8</span>       LC_NUMERIC=C              </span>
<span id="cb127-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-13"></a> [<span class="dv">3</span>] LC_TIME=en_US.UTF<span class="dv">-8</span>        LC_COLLATE=C              </span>
<span id="cb127-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-14"></a> [<span class="dv">5</span>] LC_MONETARY=en_US.UTF<span class="dv">-8</span>    LC_MESSAGES=en_US.UTF<span class="dv">-8</span>   </span>
<span id="cb127-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-15"></a> [<span class="dv">7</span>] LC_PAPER=en_US.UTF<span class="dv">-8</span>       LC_NAME=C                 </span>
<span id="cb127-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-16"></a> [<span class="dv">9</span>] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span id="cb127-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-17"></a>[<span class="dv">11</span>] LC_MEASUREMENT=en_US.UTF<span class="dv">-8</span> LC_IDENTIFICATION=C       </span>
<span id="cb127-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-18"></a></span>
<span id="cb127-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-19"></a>attached base packages<span class="op">:</span></span>
<span id="cb127-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-20"></a>[<span class="dv">1</span>] splines   stats     graphics  grDevices utils     datasets  methods  </span>
<span id="cb127-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-21"></a>[<span class="dv">8</span>] base     </span>
<span id="cb127-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-22"></a></span>
<span id="cb127-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-23"></a>other attached packages<span class="op">:</span></span>
<span id="cb127-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-24"></a><span class="st"> </span>[<span class="dv">1</span>] mice_<span class="dv">3</span>.<span class="fl">10.0</span>        broom_<span class="dv">0</span>.<span class="fl">5.6</span>        survminer_<span class="dv">0</span>.<span class="fl">4.6</span>    ggpubr_<span class="dv">0</span>.<span class="fl">2.5</span>      </span>
<span id="cb127-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-25"></a> [<span class="dv">5</span>] magrittr_<span class="fl">1.5</span>       survival_<span class="fl">3.2</span><span class="dv">-5</span>     rpart.plot_<span class="dv">3</span>.<span class="fl">0.8</span>   rpart_<span class="fl">4.1</span><span class="dv">-15</span>      </span>
<span id="cb127-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-26"></a> [<span class="dv">9</span>] naniar_<span class="dv">0</span>.<span class="fl">5.0</span>       summarytools_<span class="dv">0</span>.<span class="fl">9.6</span> arsenal_<span class="dv">3</span>.<span class="dv">4</span>.<span class="fl">0.9000</span> haven_<span class="dv">2</span>.<span class="fl">2.0</span>       </span>
<span id="cb127-27"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-27"></a>[<span class="dv">13</span>] forcats_<span class="dv">0</span>.<span class="fl">5.0</span>      stringr_<span class="dv">1</span>.<span class="fl">4.0</span>      dplyr_<span class="dv">1</span>.<span class="fl">0.0</span>        purrr_<span class="dv">0</span>.<span class="fl">3.4</span>       </span>
<span id="cb127-28"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-28"></a>[<span class="dv">17</span>] readr_<span class="dv">1</span>.<span class="fl">3.1</span>        tidyr_<span class="dv">1</span>.<span class="fl">1.0</span>        tibble_<span class="dv">3</span>.<span class="fl">0.1</span>       ggplot2_<span class="dv">3</span>.<span class="fl">3.2</span>     </span>
<span id="cb127-29"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-29"></a>[<span class="dv">21</span>] tidyverse_<span class="dv">1</span>.<span class="fl">3.0</span>   </span>
<span id="cb127-30"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-30"></a></span>
<span id="cb127-31"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-31"></a>loaded via a <span class="kw">namespace</span> (and not attached)<span class="op">:</span></span>
<span id="cb127-32"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-32"></a><span class="st"> </span>[<span class="dv">1</span>] nlme_<span class="fl">3.1</span><span class="dv">-145</span>       matrixStats_<span class="dv">0</span>.<span class="fl">56.0</span> fs_<span class="dv">1</span>.<span class="fl">3.2</span>           lubridate_<span class="dv">1</span>.<span class="fl">7.4</span>   </span>
<span id="cb127-33"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-33"></a> [<span class="dv">5</span>] httr_<span class="dv">1</span>.<span class="fl">4.1</span>         tools_<span class="dv">3</span>.<span class="fl">6.2</span>        backports_<span class="dv">1</span>.<span class="fl">1.6</span>    utf8_<span class="dv">1</span>.<span class="fl">1.4</span>        </span>
<span id="cb127-34"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-34"></a> [<span class="dv">9</span>] R6_<span class="dv">2</span>.<span class="fl">4.1</span>           mgcv_<span class="fl">1.8</span><span class="dv">-31</span>        DBI_<span class="dv">1</span>.<span class="fl">1.0</span>          colorspace_<span class="fl">1.4</span><span class="dv">-1</span>  </span>
<span id="cb127-35"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-35"></a>[<span class="dv">13</span>] nnet_<span class="fl">7.3</span><span class="dv">-13</span>        withr_<span class="dv">2</span>.<span class="fl">1.2</span>        tidyselect_<span class="dv">1</span>.<span class="fl">1.0</span>   gridExtra_<span class="fl">2.3</span>     </span>
<span id="cb127-36"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-36"></a>[<span class="dv">17</span>] compiler_<span class="dv">3</span>.<span class="fl">6.2</span>     cli_<span class="dv">2</span>.<span class="fl">0.2</span>          rvest_<span class="dv">0</span>.<span class="fl">3.5</span>        formatR_<span class="fl">1.7</span>       </span>
<span id="cb127-37"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-37"></a>[<span class="dv">21</span>] xml2_<span class="dv">1</span>.<span class="fl">3.2</span>         labeling_<span class="fl">0.3</span>       bookdown_<span class="fl">0.18</span>      scales_<span class="dv">1</span>.<span class="fl">1.0</span>      </span>
<span id="cb127-38"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-38"></a>[<span class="dv">25</span>] checkmate_<span class="dv">2</span>.<span class="fl">0.0</span>    survMisc_<span class="dv">0</span>.<span class="fl">5.5</span>     digest_<span class="dv">0</span>.<span class="fl">6.25</span>      rmarkdown_<span class="fl">2.1</span>     </span>
<span id="cb127-39"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-39"></a>[<span class="dv">29</span>] base64enc_<span class="fl">0.1</span><span class="dv">-3</span>    pkgconfig_<span class="dv">2</span>.<span class="fl">0.3</span>    htmltools_<span class="dv">0</span>.<span class="fl">5.0</span>    highr_<span class="fl">0.8</span>         </span>
<span id="cb127-40"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-40"></a>[<span class="dv">33</span>] dbplyr_<span class="dv">1</span>.<span class="fl">4.2</span>       rlang_<span class="dv">0</span>.<span class="fl">4.7</span>        readxl_<span class="dv">1</span>.<span class="fl">3.1</span>       rstudioapi_<span class="fl">0.11</span>   </span>
<span id="cb127-41"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-41"></a>[<span class="dv">37</span>] pryr_<span class="dv">0</span>.<span class="fl">1.4</span>         farver_<span class="dv">2</span>.<span class="fl">0.3</span>       generics_<span class="dv">0</span>.<span class="fl">0.2</span>     zoo_<span class="fl">1.8</span><span class="dv">-7</span>         </span>
<span id="cb127-42"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-42"></a>[<span class="dv">41</span>] jsonlite_<span class="dv">1</span>.<span class="fl">7.0</span>     rapportools_<span class="fl">1.0</span>    Matrix_<span class="fl">1.2</span><span class="dv">-18</span>      Rcpp_<span class="dv">1</span>.<span class="fl">0.4</span>        </span>
<span id="cb127-43"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-43"></a>[<span class="dv">45</span>] munsell_<span class="dv">0</span>.<span class="fl">5.0</span>      fansi_<span class="dv">0</span>.<span class="fl">4.1</span>        lifecycle_<span class="dv">0</span>.<span class="fl">2.0</span>    visdat_<span class="dv">0</span>.<span class="fl">5.3</span>      </span>
<span id="cb127-44"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-44"></a>[<span class="dv">49</span>] pROC_<span class="dv">1</span>.<span class="fl">16.1</span>        stringi_<span class="dv">1</span>.<span class="fl">4.6</span>      yaml_<span class="dv">2</span>.<span class="fl">2.1</span>         MASS_<span class="fl">7.3-51.5</span>     </span>
<span id="cb127-45"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-45"></a>[<span class="dv">53</span>] plyr_<span class="dv">1</span>.<span class="fl">8.6</span>         grid_<span class="dv">3</span>.<span class="fl">6.2</span>         crayon_<span class="dv">1</span>.<span class="fl">3.4</span>       lattice_<span class="fl">0.20</span><span class="dv">-40</span>   </span>
<span id="cb127-46"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-46"></a>[<span class="dv">57</span>] pander_<span class="dv">0</span>.<span class="fl">6.4</span>       hms_<span class="dv">0</span>.<span class="fl">5.3</span>          magick_<span class="dv">2</span>.<span class="fl">4.0</span>       knitr_<span class="fl">1.29</span>        </span>
<span id="cb127-47"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-47"></a>[<span class="dv">61</span>] pillar_<span class="dv">1</span>.<span class="fl">4.4</span>       tcltk_<span class="dv">3</span>.<span class="fl">6.2</span>        ggsignif_<span class="dv">0</span>.<span class="fl">6.0</span>     codetools_<span class="fl">0.2</span><span class="dv">-16</span>  </span>
<span id="cb127-48"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-48"></a>[<span class="dv">65</span>] reprex_<span class="dv">0</span>.<span class="fl">3.0</span>       glue_<span class="dv">1</span>.<span class="fl">4.1</span>         evaluate_<span class="fl">0.14</span>      data.table_<span class="dv">1</span>.<span class="fl">12.8</span> </span>
<span id="cb127-49"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-49"></a>[<span class="dv">69</span>] modelr_<span class="dv">0</span>.<span class="fl">1.6</span>       vctrs_<span class="dv">0</span>.<span class="fl">3.2</span>        cellranger_<span class="dv">1</span>.<span class="fl">1.0</span>   gtable_<span class="dv">0</span>.<span class="fl">3.0</span>      </span>
<span id="cb127-50"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-50"></a>[<span class="dv">73</span>] km.ci_<span class="fl">0.5</span><span class="dv">-2</span>        assertthat_<span class="dv">0</span>.<span class="fl">2.1</span>   xfun_<span class="fl">0.15</span>          xtable_<span class="fl">1.8</span><span class="dv">-4</span>      </span>
<span id="cb127-51"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb127-51"></a>[<span class="dv">77</span>] KMsurv_<span class="fl">0.1</span><span class="dv">-5</span>       ellipsis_<span class="dv">0</span>.<span class="fl">3.1</span>    </span></code></pre></div>
</div>
<div id="packages-used-1" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Packages used</h3>
<ul>
<li><a href="http://haven.tidyverse.org/">haven</a></li>
<li><a href="http://www.tidyverse.org/">tidyverse</a></li>
<li><a href="https://cran.r-project.org/web/packages/summarytools/vignettes/Introduction.html">summarytools</a>
<ul>
<li><a href="https://cran.r-project.org/web/packages/summarytools/vignettes/Recommendations-rmarkdown.html">summarytools with rmarkdown</a></li>
</ul></li>
<li><a href="https://cran.r-project.org/web/packages/arsenal/index.html">arsenal</a></li>
<li><a href="https://cran.r-project.org/web/packages/broom/vignettes/broom.html">broom</a></li>
<li><a href="https//cran.r-project.org/web/packages/survival/index.html">survival</a></li>
<li><a href="https://cran.r-project.org/web/packages/naniar/vignettes/getting-started-w-naniar.html">naniar</a></li>
<li><a href="https://www.rdocumentation.org/packages/mice/versions/current/topics/mice">mice</a></li>
</ul>
</div>
</div>
<div id="optional-ways-to-code-1" class="section level2">
<h2><span class="header-section-number">2.4</span> Optional ways to code</h2>
<div id="alt-loop" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Fit multiple models and store results</h3>
<p>Sometimes the model you are fitting can’t be handled by <code>modelsum</code>. Here is some alternative code for looping through a set of variables and storing the results.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co">## how many are there?</span></span>
<span id="cb128-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-2"></a><span class="er">&gt;</span><span class="st"> </span>nvar &lt;-<span class="st"> </span><span class="kw">length</span>(covar)</span>
<span id="cb128-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb128-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="co">## create matrix for storing results, label rows and columns</span></span>
<span id="cb128-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-5"></a><span class="er">&gt;</span><span class="st"> </span>fit.results &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> nvar, <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(covar, <span class="kw">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;coef&quot;</span>, </span>
<span id="cb128-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-6"></a><span class="op">+</span><span class="st">     &quot;std&quot;</span>, <span class="st">&quot;p.value&quot;</span>)))</span>
<span id="cb128-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb128-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-8"></a><span class="er">&gt;</span><span class="st"> </span><span class="co">## loop through the variables</span></span>
<span id="cb128-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-9"></a><span class="er">&gt;</span><span class="st"> </span><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nvar) {</span>
<span id="cb128-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-10"></a><span class="op">+</span><span class="st">     </span></span>
<span id="cb128-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-11"></a><span class="op">+</span><span class="st">     </span><span class="co">## if the variable is in my dataset, proceed</span></span>
<span id="cb128-12"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-12"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(<span class="kw">match</span>(covar[i], <span class="kw">names</span>(d1)))) {</span>
<span id="cb128-13"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-13"></a><span class="op">+</span><span class="st">         </span></span>
<span id="cb128-14"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-14"></a><span class="op">+</span><span class="st">         </span><span class="co">## paste together the formula that I want to use</span></span>
<span id="cb128-15"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-15"></a><span class="op">+</span><span class="st">         </span>text &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;coxph(Surv(tm2death,s.death) ~  &quot;</span>, covar[i], <span class="st">&quot; , data=d1)&quot;</span>, </span>
<span id="cb128-16"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-16"></a><span class="op">+</span><span class="st">             </span><span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb128-17"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-17"></a><span class="op">+</span><span class="st">         </span>fit &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> text))</span>
<span id="cb128-18"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-18"></a><span class="op">+</span><span class="st">         </span></span>
<span id="cb128-19"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-19"></a><span class="op">+</span><span class="st">         </span><span class="co">## pull off the summary, print</span></span>
<span id="cb128-20"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-20"></a><span class="op">+</span><span class="st">         </span>prob &lt;-<span class="st"> </span><span class="kw">summary</span>(fit)</span>
<span id="cb128-21"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-21"></a><span class="op">+</span><span class="st">         </span></span>
<span id="cb128-22"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-22"></a><span class="op">+</span><span class="st">         </span><span class="co">## pull off the coefficient and std.error (last row of fit)</span></span>
<span id="cb128-23"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-23"></a><span class="op">+</span><span class="st">         </span>fit.results[i, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>] &lt;-<span class="st"> </span>prob<span class="op">$</span>coef[<span class="kw">nrow</span>(prob<span class="op">$</span>coef), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>)]</span>
<span id="cb128-24"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-24"></a><span class="op">+</span><span class="st">         </span>fit.results[i, <span class="dv">1</span>] &lt;-<span class="st"> </span>prob<span class="op">$</span>n</span>
<span id="cb128-25"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-25"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb128-26"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb128-26"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
</div>
<div id="fit-models-by-some-variable" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Fit models “by” some variable</h3>
<p>In SAS you can run a model “by” some variable, such as gender. In R you can do the same thing using the following code. The <code>group_by()</code> function tells R to run the analysis by that variable (or variables) and the <code>do()</code> function tells R what to do.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-1"></a><span class="op">&gt;</span><span class="st"> </span>ans &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">coxph</span>(<span class="kw">Surv</span>(tm2death, s.death) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span></span>
<span id="cb129-2"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-2"></a><span class="op">+</span><span class="st">     </span>cardioshock, <span class="dt">data =</span> .data), <span class="dt">exponentiate =</span> T, <span class="dt">confint =</span> T))</span>
<span id="cb129-3"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-3"></a><span class="op">&gt;</span><span class="st"> </span>ans</span>
<span id="cb129-4"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-4"></a><span class="co"># A tibble: 4 x 8</span></span>
<span id="cb129-5"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-5"></a><span class="co"># Groups:   gender [2]</span></span>
<span id="cb129-6"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-6"></a>  gender term           estimate std.error statistic  p.value conf.low conf.high</span>
<span id="cb129-7"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-7"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">             </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb129-8"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-8"></a><span class="dv">1</span> Female age                <span class="fl">1.03</span>   <span class="fl">0.00636</span>      <span class="fl">5.41</span> <span class="fl">6.27</span>e<span class="op">-</span><span class="st"> </span><span class="dv">8</span>    <span class="fl">1.02</span>       <span class="fl">1.05</span></span>
<span id="cb129-9"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-9"></a><span class="dv">2</span> Female cardioshockYes     <span class="fl">1.73</span>   <span class="fl">0.298</span>        <span class="fl">1.83</span> <span class="fl">6.65</span>e<span class="op">-</span><span class="st"> </span><span class="dv">2</span>    <span class="fl">0.963</span>      <span class="fl">3.10</span></span>
<span id="cb129-10"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-10"></a><span class="dv">3</span> Male   age                <span class="fl">1.08</span>   <span class="fl">0.00503</span>     <span class="fl">15.1</span>  <span class="fl">1.15e-51</span>    <span class="fl">1.07</span>       <span class="fl">1.09</span></span>
<span id="cb129-11"><a href="scenario-2-in-depth-modeling-and-plotting-with-cleaned-data.html#cb129-11"></a><span class="dv">4</span> Male   cardioshockYes     <span class="fl">3.26</span>   <span class="fl">0.203</span>        <span class="fl">5.83</span> <span class="fl">5.65</span>e<span class="op">-</span><span class="st"> </span><span class="dv">9</span>    <span class="fl">2.19</span>       <span class="fl">4.86</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scenario-1-getting-familiar-with-a-new-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "none",
"toc_depth": 4
}
});
});
</script>

</body>

</html>
